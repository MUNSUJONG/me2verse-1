<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Me2Verse ë©”íƒ€ë²„ìŠ¤ (ìŠ¤í† ë¦¬ í™•ì¥ Â· Piì½”ì¸ ê²°ì œ)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg:#f7f7fb; --card:#ffffff; --text:#111; --muted:#666; --brand:#6C5CE7; --ok:#2ecc71; --warn:#ff9800; --danger:#ef5350; --chip:#eef1ff;
  }
  [data-theme="dark"]{
    --bg:#0f1115; --card:#151924; --text:#f5f7ff; --muted:#aab1c5; --brand:#8e8aff; --ok:#49d48a; --warn:#ffb547; --danger:#ff6f6f; --chip:#1e2230;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui, -apple-system, "Segoe UI", Arial, sans-serif; background:var(--bg); color:var(--text);}
  .screen{position:absolute; inset:0; display:none; padding:20px; overflow:auto;}
  .screen.active{display:block;}
  .center{display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100dvh;}
  .container{width:min(1200px, 92%); margin:0 auto;}
  .card{background:var(--card); border-radius:16px; box-shadow:0 6px 30px rgba(0,0,0,.08); padding:20px;}
  h1,h2,h3{margin:.3em 0}
  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
  .flags{display:flex; justify-content:space-between; width:min(420px, 92vw); margin:8px auto 12px;}
  .flags img{width:84px; height:auto; filter:drop-shadow(0 2px 4px rgba(0,0,0,.2))}
  input, select, button{font-size:16px; padding:10px 14px; border-radius:10px; border:1px solid #d6daf5; background:var(--card); color:var(--text);}
  input, select{min-width:210px}
  button{cursor:pointer; border:none; background:var(--brand); color:white;}
  button.ghost{background:transparent; border:1px solid #8690ff; color:var(--brand)}
  button.success{background:var(--ok)} button.warn{background:var(--warn)} button.danger{background:var(--danger)}
  .status, .score{
    position:fixed; left:50%; transform:translateX(-50%); z-index:10; padding:8px 12px; border-radius:10px;
    background:rgba(255,255,255,.75); color:#111; font-weight:600; backdrop-filter:blur(6px); border:1px solid rgba(0,0,0,.05);
  }
  [data-theme="dark"] .status, [data-theme="dark"] .score{background:rgba(18,22,33,.6); color:#e9ecff; border-color:#000}
  .status{top:12px;} .score{bottom:12px;}
  .score small{opacity:.8; font-weight:500}
  .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(260px,1fr)); gap:16px;}
  .story-card{display:flex; flex-direction:column; gap:10px}
  .thumb{aspect-ratio:16/9; width:100%; border-radius:12px; background:#cfd4ff; overflow:hidden; position:relative}
  .thumb span{position:absolute; right:10px; top:10px; background:var(--chip); color:var(--brand); padding:6px 10px; border-radius:999px; font-weight:700}
  .chips{display:flex; gap:6px; flex-wrap:wrap}
  .chip{background:var(--chip); color:var(--muted); padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700}
  .muted{color:var(--muted)}
  .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin:8px 0 14px}
  .left, .right{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace; font-size:12px; padding:2px 6px; border-radius:6px; background:var(--chip); color:var(--muted)}
  /* Quest log */
  #questLog{position:fixed; right:16px; bottom:84px; width:min(360px, 92vw); max-height:44vh; overflow:auto; z-index:9}
  /* Toast */
  .toast{position:fixed; right:16px; top:16px; display:grid; gap:8px; z-index:11}
  .toast .t{background:var(--card); border:1px solid #e3e6ff22; padding:10px 12px; border-radius:12px; box-shadow:0 6px 24px rgba(0,0,0,.12)}
</style>
</head>
<body data-theme="light">

<!-- ê³ ì • HUD -->
<div id="status" class="status">ìƒíƒœ: ëŒ€ê¸° ì¤‘</div>
<div id="score" class="score">í¬ì¸íŠ¸: <b id="points">0</b> | ì•„ì´í…œ: <b id="items">ì—†ìŒ</b> <small class="kbd">Ï€ Pi ê²°ì œ</small></div>
<div id="questLog" class="container"></div>
<div id="toast" class="toast"></div>

<!-- í™ˆ(ë¡œê·¸ì¸/ê²°ì œ) -->
<section id="homeScreen" class="screen active">
  <div class="center container">
    <div class="flags">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg" alt="íƒœê·¹ê¸°(ì¢Œ)">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg" alt="íƒœê·¹ê¸°(ìš°)">
    </div>
    <div class="card" style="text-align:center; width:min(560px, 96vw);">
      <h1>ğŸš€ Me2Verse ë©”íƒ€ë²„ìŠ¤</h1>
      <p class="muted">ë¡œê·¸ì¸ â†’ <b>Ï€ Piì½”ì¸</b> ê²°ì œ â†’ ëª¨ë“ˆ ì„ íƒ â†’ ìŠ¤í† ë¦¬ ì²´í—˜</p>
      <div class="row" style="justify-content:center; margin-top:6px">
        <input type="text" id="username" placeholder="ìœ ì € ì´ë¦„ ì…ë ¥" />
        <select id="amount">
          <option value="1">1 Piì½”ì¸</option>
          <option value="5">5 Piì½”ì¸</option>
          <option value="10">10 Piì½”ì¸</option>
        </select>
      </div>
      <div style="margin-top:4px">
        <button id="autoBtn">ìë™ ë¡œê·¸ì¸ + ê²°ì œ</button>
        <button id="toggleTheme" class="ghost">ë‹¤í¬ëª¨ë“œ</button>
      </div>
      <p id="homeHint" class="muted" style="margin-top:10px">ê²°ì œ ì‹œ í‘œì‹œ: <span class="kbd">Ï€</span> ì•„ì´ì½˜ê³¼ í•¨ê»˜ ì•Œë¦¼ìœ¼ë¡œ ì•ˆë‚´ë©ë‹ˆë‹¤.</p>
    </div>
  </div>
</section>

<!-- ëª¨ë“ˆ ì„ íƒ -->
<section id="moduleScreen" class="screen">
  <div class="container">
    <div class="toolbar">
      <div class="left">
        <h2 style="margin-right:6px">ëª¨ë“ˆ ì„ íƒ</h2>
        <span class="chip">ì—°ì• </span><span class="chip">ì—”í„°</span><span class="chip">ìš°ì£¼</span><span class="chip">ì·¨ë¯¸</span><span class="chip">ë„ì‹œ/ì‚¬íšŒ</span>
      </div>
      <div class="right">
        <input id="searchInput" placeholder="ìŠ¤í† ë¦¬ ê²€ìƒ‰ (ì˜ˆ: ê²°í˜¼, ìš°ì£¼ì„ ...)" />
        <select id="sortSelect">
          <option value="popular">ì¸ê¸°ìˆœ</option>
          <option value="new">ìµœì‹ ìˆœ</option>
          <option value="easy">ì‰¬ìš´ ìˆœ</option>
          <option value="hard">ì–´ë ¤ìš´ ìˆœ</option>
          <option value="short">ì§§ì€ í”Œë ˆì´</option>
          <option value="long">ê¸´ í”Œë ˆì´</option>
        </select>
        <button id="backToHome" class="ghost">â† í™ˆ</button>
      </div>
    </div>

    <div class="row" style="margin-bottom:10px">
      <button class="ghost" data-module="romance">ğŸ’ ì—°ì•  & ê²°í˜¼</button>
      <button class="ghost" data-module="entertain">ğŸ¤ ì—”í„°í…Œì¸ë¨¼íŠ¸</button>
      <button class="ghost" data-module="space">ğŸª ìš°ì£¼</button>
      <button class="ghost" data-module="hobby">ğŸ¨ ì·¨ë¯¸/ì°½ì‘</button>
      <button class="ghost" data-module="city">ğŸ™ ë„ì‹œ/ì‚¬íšŒ</button>
    </div>

    <div id="moduleTitleWrap" class="row" style="align-items:baseline">
      <h3 id="moduleTitle" style="margin-right:8px">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
      <span id="moduleMeta" class="muted"></span>
    </div>

    <div id="storiesGrid" class="grid" style="margin-top:10px"></div>
  </div>
</section>

<!-- ìŠ¤í† ë¦¬ í”Œë ˆì´ -->
<section id="playScreen" class="screen">
  <div class="container">
    <div class="toolbar">
      <div class="left">
        <button id="backToModule" class="ghost">â† ëª©ë¡</button>
        <h2 id="playTitle" style="margin-left:6px"></h2>
      </div>
      <div class="right">
        <span class="chip" id="playDiff"></span>
        <span class="chip" id="playTime"></span>
        <span class="chip" id="playReward"></span>
      </div>
    </div>

    <div class="card">
      <div id="playThumb" class="thumb" style="margin-bottom:10px;">
        <span id="playBadge">STORY</span>
      </div>
      <p id="playDesc" class="muted"></p>
      <div id="playSteps" class="row" style="margin-top:10px"></div>
      <div class="row" style="margin-top:10px">
        <button id="startStory" class="success">ì‹œì‘</button>
        <button id="completeStory" class="warn" disabled>ì™„ë£Œ ì²˜ë¦¬</button>
      </div>
    </div>
  </div>
</section>

<script>
/* ===== ì „ì—­ ìƒíƒœ ===== */
const els = {
  status: document.getElementById('status'),
  points: document.getElementById('points'),
  items: document.getElementById('items'),
  toast: document.getElementById('toast'),
  questLog: document.getElementById('questLog'),
  screens: {
    home: document.getElementById('homeScreen'),
    module: document.getElementById('moduleScreen'),
    play: document.getElementById('playScreen'),
  },
  inputs: {
    username: document.getElementById('username'),
    amount: document.getElementById('amount'),
    search: document.getElementById('searchInput'),
    sort: document.getElementById('sortSelect'),
  },
  module: {
    title: document.getElementById('moduleTitle'),
    meta: document.getElementById('moduleMeta'),
    grid: document.getElementById('storiesGrid'),
  },
  play: {
    title: document.getElementById('playTitle'),
    diff: document.getElementById('playDiff'),
    time: document.getElementById('playTime'),
    reward: document.getElementById('playReward'),
    thumb: document.getElementById('playThumb'),
    badge: document.getElementById('playBadge'),
    desc: document.getElementById('playDesc'),
    steps: document.getElementById('playSteps'),
    start: document.getElementById('startStory'),
    complete: document.getElementById('completeStory'),
  },
  buttons: {
    auto: document.getElementById('autoBtn'),
    backHome: document.getElementById('backToHome'),
    backModule: document.getElementById('backToModule'),
    theme: document.getElementById('toggleTheme'),
  }
};

let state = {
  loggedIn: false,
  user: null,
  points: 0,
  items: [],
  currentModule: null,
  currentStory: null,
  progress: {}, // storyId -> completed
  theme: 'light',
};

function setStatus(msg){ els.status.textContent = msg; }
function toast(msg){
  const t = document.createElement('div'); t.className='t'; t.textContent = msg;
  els.toast.appendChild(t); setTimeout(()=>{ t.remove(); }, 2600);
}
function hudUpdate(){
  els.points.textContent = state.points;
  els.items.textContent = state.items.length ? state.items.join(', ') : 'ì—†ìŒ';
}
function logQuest(msg){
  const wrap = document.createElement('div');
  wrap.className = 'card';
  wrap.innerHTML = `<b>í€˜ìŠ¤íŠ¸</b><br>${msg}`;
  els.questLog.prepend(wrap);
  setTimeout(()=>{ wrap.style.opacity=.9; }, 10);
}

/* ===== ë¡œê·¸ì¸ + ê²°ì œ (ìš”ì²­ëŒ€ë¡œ ê¸°ì¡´ íë¦„ ìœ ì§€, ë¬¸êµ¬ë§Œ Piì½”ì¸) ===== */
document.getElementById("autoBtn").addEventListener("click", ()=>{
  const username = els.inputs.username.value.trim();
  const amount = els.inputs.amount.value;
  if(!username){ alert("ìœ ì € ì´ë¦„ ì…ë ¥ í•„ìš”!"); return; }
  setStatus(`ìƒíƒœ: ${username} ë¡œê·¸ì¸ ì¤‘...`);
  setTimeout(()=>{
    setStatus(`ìƒíƒœ: ${username} ë¡œê·¸ì¸ ì„±ê³µ! ğŸ‰`);
    setStatus(`ìƒíƒœ: ${amount} Piì½”ì¸ ê²°ì œ ì²˜ë¦¬ ì¤‘...`);
    setTimeout(()=>{
      setStatus(`ìƒíƒœ: ${username} ê²°ì œ ì™„ë£Œ! ğŸ’°`);
      alert(`${username}ë‹˜ì˜ ${amount} Piì½”ì¸ ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! Ï€`);
      state.loggedIn = true; state.user = username;
      switchScreen('home', 'module');
      toast('í™˜ì˜í•©ë‹ˆë‹¤! ëª¨ë“ˆì„ ì„ íƒí•´ ìŠ¤í† ë¦¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”.');
    },1500);
  },1000);
});

/* ===== í™”ë©´ ì „í™˜ ===== */
function switchScreen(from, to){
  els.screens[from].classList.remove('active');
  els.screens[to].classList.add('active');
}
document.getElementById('backToHome').addEventListener('click', ()=> switchScreen('module','home'));
document.getElementById('backToModule').addEventListener('click', ()=> switchScreen('play','module'));

/* ===== í…Œë§ˆ ===== */
document.getElementById('toggleTheme').addEventListener('click', ()=>{
  state.theme = (state.theme === 'light') ? 'dark' : 'light';
  document.body.setAttribute('data-theme', state.theme);
});

/* ===== ë°ì´í„°: ëª¨ë“ˆ/ìŠ¤í† ë¦¬ 10ê°œì”© ===== */
const DB = {
  romance: {
    title:'ğŸ’ ì—°ì•  & ê²°í˜¼',
    stories:[
      s('ì²«ì‚¬ë‘ê³¼ì˜ ì¬íšŒ','ê³µì›ì—ì„œ ìš°ì—°íˆ ì¬íšŒ, ëŒ€í™”ë¥¼ í†µí•´ ì‹ ë¢° í¬ì¸íŠ¸ë¥¼ ëª¨ì•„ë³´ì„¸ìš”.','ì‰¬ì›€','5ë¶„','í•˜íŠ¸ ëª©ê±¸ì´',[
        step('ê³µì› ì…ì¥','ì¸ì‚¬ë¥¼ ê±´ë„¨ë‹¤','ë¬´ì‹œí•œë‹¤','ì¸ì‚¬ ì„±ê³µ! ì¹œë°€ë„ +1','ê¸°ë¶„ ìƒí•¨â€¦'),
        step('ì¹´í˜ ì œì•ˆ','ì¹´í˜ë¡œ ì´ë™','ë‹¤ìŒì— ë³´ì','ë”°ëœ»í•œ ë¼ë–¼ë¡œ ëŒ€í™” +1','ê¸°íšŒê°€ ë©€ì–´ì§„ë‹¤')
      ]),
      s('êµ­ì œ ì—°ì•  ì²´í—˜','ë‹¤ë¥¸ ë¬¸í™”ê¶Œ íŒŒíŠ¸ë„ˆì™€ ë°ì´íŠ¸ ì½”ìŠ¤ ë§ì¶”ê¸°','ë³´í†µ','7ë¶„','ë²ˆì—­ê¸° ë±ƒì§€'),
      s('ê°€ìƒ ê²°í˜¼ì‹ ì¤€ë¹„','ì‹ì¥ ê³ ë¥´ê¸°Â·ì²­ì²©ì¥Â·ë¦¬í—ˆì„¤ì„ ë§ˆì¹˜ì','ë³´í†µ','10ë¶„','ì›¨ë”© ì´ˆëŒ€ê¶Œ'),
      s('ë¶€ëª¨ë‹˜ ì„¤ë“ ì‘ì „','ê°€ì¹˜ê´€ ëŒ€í™”ì™€ ì´ë²¤íŠ¸ë¡œ í˜¸ê° ì˜¬ë¦¬ê¸°','ì–´ë ¤ì›€','12ë¶„','ê°€ì¡±ì˜ ì¶•ë³µ'),
      s('ë°ì´íŠ¸ ì½”ìŠ¤ íˆ¬ì–´','ì•¼ê²½/ì „ì‹œ/ë†€ì´ê³µì› ì¤‘ ì„ íƒí˜• ë£¨íŠ¸','ì‰¬ì›€','6ë¶„','í´ë¼ë¡œì´ë“œ'),
      s('ì¥ê±°ë¦¬ ì—°ì•  ì±Œë¦°ì§€','ì¼ì •/ì„ ë¬¼/ì˜ìƒí†µí™” ê´€ë¦¬ ë¯¸ì…˜','ë³´í†µ','8ë¶„','íƒë°° ì¿ í°'),
      s('ì¹œêµ¬ì™€ ì—°ì•  ê²½ìŸ','ê³µì • í”Œë ˆì´ë¡œ ì‹ ë¢° ì§€í‚¤ê¸°','ì–´ë ¤ì›€','9ë¶„','ê³µì •ì˜ íœ˜ì¥'),
      s('ê°€ìƒ ì•„ì´ ì–‘ìœ¡','ì¼ì •Â·ë†€ì´Â·êµìœ¡ ë°¸ëŸ°ìŠ¤ ë§ì¶”ê¸°','ë³´í†µ','10ë¶„','ìœ¡ì•„ ë…¸í•˜ìš°'),
      s('ê²°í˜¼ 10ì£¼ë…„ ì´ë²¤íŠ¸','ì¶”ì–µ íšŒìƒ í€˜ìŠ¤íŠ¸ë¡œ ê¹œì§ íŒŒí‹°','ì‰¬ì›€','5ë¶„','ê¸°ë… ë°˜ì§€'),
      s('ìœ„ê¸° ê·¹ë³µ: ì‹ ë¢° íšŒë³µ','ì˜¤í•´ í•´ì†Œ ëŒ€í™” íŠ¸ë¦¬ í´ë¦¬ì–´','ì–´ë ¤ì›€','12ë¶„','ì‹ ë¢°ì˜ ì•½ì†')
    ]
  },
  entertain:{
    title:'ğŸ¤ ì—”í„°í…Œì¸ë¨¼íŠ¸',
    stories:[
      s('ì˜¤ë””ì…˜ í•©ê²©ì˜ ìˆœê°„','ë³´ì»¬/ëŒ„ìŠ¤/ì—°ê¸°ë¥¼ ì„ íƒí•˜ê³  í‰ê°€ ë°›ê¸°','ë³´í†µ','8ë¶„','ì—°ìŠµì‹¤ í‚¤'),
      s('ì²« ë¬´ëŒ€ ë°ë·”','ì¹´ë©”ë¼ ë™ì„ /ì•ˆë¬´ íƒ€ì´ë° ë§ì¶”ê¸°','ì–´ë ¤ì›€','10ë¶„','ë¬´ëŒ€ ì˜ìƒ'),
      s('íŒ¬ë¯¸íŒ… ì´ë²¤íŠ¸','í¬í† ë¶€ìŠ¤Â·ì‚¬ì¸íšŒÂ·QnA ìš´ì˜','ì‰¬ì›€','6ë¶„','íŒ¬ ê°ì‚¬íŒ¨'),
      s('ì•¨ë²” ì œì‘','ê³¡ ì„ ì •Â·ë…¹ìŒÂ·ë§ˆìŠ¤í„°ë§ ì™„ë£Œ','ë³´í†µ','12ë¶„','í•œì • í¬í† ì¹´ë“œ'),
      s('ë®¤ë¹„ ì´¬ì˜','ë¡œì¼€ì´ì…˜/ì½˜í‹°/ì»· í¸ì§‘','ë³´í†µ','9ë¶„','ê°ë…ì˜ ìŠ¬ë ˆì´íŠ¸'),
      s('íŒ€ í•´ì²´ ìœ„ê¸°','ê°ˆë“± ì¤‘ì¬ì™€ ëª©í‘œ ì¬ì •ë¦½','ì–´ë ¤ì›€','12ë¶„','íŒ€ì›Œí¬ íœ˜ì¥'),
      s('ì†”ë¡œ ë°ë·”','ì»¨ì…‰ ê¸°íšê³¼ ë¬´ëŒ€ ì—°ì¶œ','ì–´ë ¤ì›€','11ë¶„','ì†”ë¡œ í¬ë¼ìš´'),
      s('í•´ì™¸ íˆ¬ì–´','ë¹„ìÂ·ìˆ™ì†ŒÂ·ì¥ë¹„ ì²´í¬ë¦¬ìŠ¤íŠ¸','ë³´í†µ','10ë¶„','íˆ¬ì–´ íŒ¨ì¹˜'),
      s('íŒ¬ê³¼ ì†Œí†µ','ë¼ì´ë¸ŒÂ·ëŒ“ê¸€ ê´€ë¦¬ ë§¤ë„ˆ ì ìˆ˜','ì‰¬ì›€','7ë¶„','ì†Œí†µ ë°°ì§€'),
      s('ìŠ¤íƒ€ ë£¨ë¨¸ ëŒ€ì‘','íŒ©íŠ¸ ì²´í¬Â·ê³µì‹ì…ì¥ ìˆ˜ë¦½','ì–´ë ¤ì›€','10ë¶„','ì‹ ë¢° ë°°ì§€')
    ]
  },
  space:{
    title:'ğŸª ìš°ì£¼',
    stories:[
      s('ë‹¬ ì°©ë¥™','ì—°ë£Œ/ê°ë„/ì†ë„ ì œì–´ ë¯¸ë‹ˆ ì‹œë®¬','ë³´í†µ','8ë¶„','ì›”ì„ íŒŒí¸'),
      s('í™”ì„± ê°œì²™','ê±°ì£¼ ëª¨ë“ˆÂ·ìˆ˜ë¶„ ì¶”ì¶œÂ·ì‘ë¬¼ ì¬ë°°','ì–´ë ¤ì›€','12ë¶„','ê°œì²™ì íœ˜ì¥'),
      s('ë¸”ë™í™€ íƒí—˜','ê³¼í•™ì  í•œê³„ ë‚´ ì‹œë®¬ ì²´í—˜','ì–´ë ¤ì›€','10ë¶„','ì¤‘ë ¥ ê¸°ë¡'),
      s('ì™¸ê³„ ë¬¸ëª… ì¡°ìš°','ì‹ í˜¸ í•´ë… ë° ì˜ì „ í”„ë¡œí† ì½œ','ë³´í†µ','9ë¶„','ì™¸êµ ë°°ì§€'),
      s('ìš°ì£¼ì„  ì¡°ì¢…','í•­ë²•Â·ì›Œí”„ í…ŒìŠ¤íŠ¸','ë³´í†µ','9ë¶„','ì¡°ì¢… ë©´í—ˆ'),
      s('ì¸ë¥˜ ì´ì£¼ í”„ë¡œì íŠ¸','í–‰ì„± í‰ê°€Â·ìœ„í—˜ ê´€ë¦¬','ì–´ë ¤ì›€','12ë¶„','ê°œì²™ ì²­ì‚¬ì§„'),
      s('ìš°ì£¼ í˜¸í…”','ë¬´ì¤‘ë ¥ ì„œë¹„ìŠ¤ ìš´ì˜','ì‰¬ì›€','6ë¶„','í˜¸í…” í‚¤ì¹´ë“œ'),
      s('ë¬´ì¤‘ë ¥ ìŠ¤í¬ì¸ ','ê·œì¹™ ì ì‘ ë° ë¦¬ê·¸ ì°¸ê°€','ë³´í†µ','8ë¶„','ìŠ¤í¬ì¸  ë©”ë‹¬'),
      s('íƒœì–‘ í”Œë ˆì–´ ëŒ€ì‘','ì‹¤ë“œ ê°€ë™Â·ìŠ¹ë¬´ì› ë³´í˜¸','ì–´ë ¤ì›€','10ë¶„','êµ¬ì¡° íœ˜ì¥'),
      s('AI ë¡œë´‡ ë™ë°˜','íƒì‚¬ ì„ë¬´ í˜‘ì—…','ë³´í†µ','8ë¶„','ë™ë°˜ì ì¹©')
    ]
  },
  hobby:{
    title:'ğŸ¨ ì·¨ë¯¸/ì°½ì‘',
    stories:[
      s('ê°€ìƒ ì „ì‹œíšŒ','íë ˆì´ì…˜/ë°°ì¹˜/ì˜¤í”„ë‹ ì§„í–‰','ë³´í†µ','8ë¶„','ì˜¤í”„ë‹ ì´ˆëŒ€ì¥'),
      s('ë¯¸ìˆ  ê²½ë§¤','ì‘í’ˆ ê°ì •Â·ì…ì°° ì „ëµ','ì–´ë ¤ì›€','10ë¶„','ê²½ë§¤ ë§ì¹˜'),
      s('ìš”ë¦¬ ëŒ€íšŒ','ë ˆì‹œí”¼Â·íƒ€ì´ë°Â·í”Œë ˆì´íŒ…','ë³´í†µ','9ë¶„','ê¸ˆë¹› êµ­ì'),
      s('ë©”íƒ€ íŒ¨ì…˜ì‡¼','ë£© êµ¬ì„±Â·ëŸ°ì›¨ì´ ìš´ì˜','ë³´í†µ','9ë¶„','ìŠ¤íƒ€ì¼ ë°°ì§€'),
      s('ê±´ì¶•ê°€ ì²´í—˜','ë„ë©´ ì„¤ê³„Â·ì‹¬ì‚¬ ëŒ€ì‘','ì–´ë ¤ì›€','12ë¶„','ê±´ì¶• íŠ¸ë¡œí”¼'),
      s('ëŒ„ìŠ¤ ë°°í‹€','ì½¤ë³´Â·ë°•ìÂ·ì—°ì¶œ í¬ì¸íŠ¸','ë³´í†µ','8ë¶„','ëŒ„ìŠ¤ í† í°'),
      s('ì˜í™” ì œì‘','ì‹œë‚˜ë¦¬ì˜¤Â·ì´¬ì˜Â·í¸ì§‘','ë³´í†µ','10ë¶„','í´ë˜í¼ë³´ë“œ'),
      s('ì†Œì„¤ ì‘ê°€ ë°ë·”','í”„ë¡œë¡œê·¸Â·í´ë¦¬ì…° ë’¤ì§‘ê¸°','ë³´í†µ','9ë¶„','ì´ˆíŒë³¸'),
      s('ìŠ¤íŠ¸ë¦¬ë¨¸ ì²´í—˜','ì„¸íŒ…Â·ì±„íŒ… ë§¤ë‹ˆì§•','ì‰¬ì›€','6ë¶„','íŒŒíŠ¸ë„ˆ ë°°ì§€'),
      s('eìŠ¤í¬ì¸  í† ë„ˆë¨¼íŠ¸','íŒ€ ë¹Œë“œÂ·ì „ìˆ  ì½œ','ì–´ë ¤ì›€','12ë¶„','ì±”í”¼ì–¸ ë§')
    ]
  },
  city:{
    title:'ğŸ™ ë„ì‹œ/ì‚¬íšŒ',
    stories:[
      s('ì§ì¥ì¸ ë°ì´','í”„ë¡œì íŠ¸/íšŒì˜/ë³´ê³ ì„œ ì±Œë¦°ì§€','ë³´í†µ','8ë¶„','ì„±ê³¼ ë³´ë„ˆìŠ¤'),
      s('ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…','MVPÂ·í”¼ë²—Â·íˆ¬ììœ ì¹˜','ì–´ë ¤ì›€','12ë¶„','ì°½ì—… ë°°ì§€'),
      s('ì„ ê±° ìœ ì„¸','ê³µì•½Â·í† ë¡ Â·í˜„ì¥ ì†Œí†µ','ë³´í†µ','10ë¶„','ë¯¼ì£¼ ë°°ì§€'),
      s('ëŒ€í†µë ¹ ì‹œë®¬','ìœ„ê¸°ê´€ë¦¬Â·í˜‘ì¹˜Â·ê²°ì •','ì–´ë ¤ì›€','12ë¶„','êµ­ì • ë°°ì§€'),
      s('ê¸°ì ì·¨ì¬','íŒ©íŠ¸ì²´í¬Â·ìœ¤ë¦¬Â·ê¸°ì‚¬ ì†¡ê³ ','ë³´í†µ','9ë¶„','ë³´ë„ íŒ¨ìŠ¤'),
      s('ì˜ë£Œ ì‹œë®¬','ë¬¸ì§„Â·ì‘ê¸‰Â·íŒ€ì›Œí¬','ì–´ë ¤ì›€','11ë¶„','ì˜ë£Œ íœ˜ì¥'),
      s('ë²•ì • ê³µë°©','ì¦ê±°Â·ì¦ì–¸Â·ë…¼ë¦¬ ì „ê°œ','ì–´ë ¤ì›€','10ë¶„','ì •ì˜ì˜ ì €ìš¸'),
      s('ì¬ë‚œ êµ¬ì¡°','ëŒ€í”¼/ì§€ì›/ì»¤ë®¤ë‹ˆí‹° ì—°ê³„','ë³´í†µ','9ë¶„','êµ¬ì¡° ë°°ì§€'),
      s('ë„ì‹œ ê±´ì„¤','ì¸í”„ë¼Â·í™˜ê²½Â·ì˜ˆì‚° ê· í˜•','ë³´í†µ','10ë¶„','ë„ì‹œ ì„¤ê³„ë„'),
      s('ê²½ì œ ìœ„ê¸° ëŒ€ì‘','í†µí™”/ì¬ì •/ì‹¬ë¦¬ ì•ˆì •','ì–´ë ¤ì›€','12ë¶„','ì•ˆì • ì±„ê¶Œ')
    ]
  }
};

/* ìŠ¤í† ë¦¬ ìƒì„± í—¬í¼ */
function s(title, desc, diff='ë³´í†µ', time='8ë¶„', reward='ëœë¤ ë³´ìƒ', steps){
  return {
    id: title + '_' + Math.random().toString(36).slice(2,7),
    title, desc, diff, time, reward,
    thumb: `https://picsum.photos/seed/${encodeURIComponent(title)}/640/360`,
    steps: steps || [
      step('ì¸íŠ¸ë¡œ','ì‹œì‘í•œë‹¤','ë‚˜ì¤‘ì—','ì¢‹ì€ ì¶œë°œ!','ê¸°íšŒê°€ ì¤„ì–´ë“ ë‹¤'),
      step('í•µì‹¬ ì„ íƒ','ë„ì „í•œë‹¤','ì•ˆì „í•˜ê²Œ ê°„ë‹¤','ë³´ìƒ í™•ë¥  â†‘','ì•ˆì „í•˜ì§€ë§Œ ë³´ìƒ â†“'),
      step('ì—”ë”©','ì™„ìˆ˜í•œë‹¤','í¬ê¸°í•œë‹¤','ì™„ë£Œ!','ì‹¤íŒ¨â€¦')
    ]
  }
}
function step(title, a, b, aMsg, bMsg){ return {title, a, b, aMsg, bMsg}; }

/* ===== ëª¨ë“ˆ ë Œë”ë§ ===== */
const moduleButtons = document.querySelectorAll('[data-module]');
moduleButtons.forEach(btn=> btn.addEventListener('click', ()=> loadModule(btn.dataset.module)));

function loadModule(key){
  const mod = DB[key];
  state.currentModule = key;
  els.module.title.textContent = mod.title;
  els.module.meta.textContent = `ì´ ${mod.stories.length}ê°œ ìŠ¤í† ë¦¬`;
  renderStories(mod.stories);
}

function renderStories(list){
  const q = els.inputs.search.value.trim().toLowerCase();
  let filtered = list.filter(s=> s.title.toLowerCase().includes(q) || s.desc.toLowerCase().includes(q));
  switch(els.inputs.sort.value){
    case 'easy': filtered.sort((a,b)=> diffRank(a.diff)-diffRank(b.diff)); break;
    case 'hard': filtered.sort((a,b)=> diffRank(b.diff)-diffRank(a.diff)); break;
    case 'short': filtered.sort((a,b)=> timeToMin(a.time)-timeToMin(b.time)); break;
    case 'long': filtered.sort((a,b)=> timeToMin(b.time)-timeToMin(a.time)); break;
    case 'new': filtered.sort((a,b)=> a.id<b.id?1:-1); break;
    default: /* popular */ filtered.sort((a,b)=> a.title>b.title?1:-1);
  }
  els.module.grid.innerHTML = '';
  filtered.forEach(story=>{
    const card = document.createElement('div');
    card.className = 'card story-card';
    card.innerHTML = `
      <div class="thumb" style="background:url('${story.thumb}') center/cover no-repeat">
        <span>${state.progress[story.id] ? 'COMPLETED' : 'NEW'}</span>
      </div>
      <h3>${story.title}</h3>
      <p class="muted">${story.desc}</p>
      <div class="chips">
        <span class="chip">ë‚œì´ë„: ${story.diff}</span>
        <span class="chip">ì†Œìš”: ${story.time}</span>
        <span class="chip">ë³´ìƒ: ${story.reward}</span>
      </div>
      <div class="row" style="margin-top:6px">
        <button data-play="${story.id}">ì‹œì‘</button>
        <button class="ghost" data-like="${story.id}">â¤ï¸ ì°œ</button>
      </div>
    `;
    card.querySelector('[data-play]').addEventListener('click', ()=> openStory(story));
    card.querySelector('[data-like]').addEventListener('click', ()=> toast('ì°œ ëª©ë¡ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.'));
    els.module.grid.appendChild(card);
  });
}

els.inputs.search.addEventListener('input', ()=> {
  if(!state.currentModule) return;
  renderStories(DB[state.currentModule].stories);
});
els.inputs.sort.addEventListener('change', ()=> {
  if(!state.currentModule) return;
  renderStories(DB[state.currentModule].stories);
});
function diffRank(d){ return d==='ì‰¬ì›€'?1: d==='ë³´í†µ'?2: 3; }
function timeToMin(t){ return parseInt(String(t).replace(/\D/g,''))||8; }

/* ===== ìŠ¤í† ë¦¬ í”Œë ˆì´ ===== */
function openStory(story){
  state.currentStory = story;
  els.play.title.textContent = story.title;
  els.play.diff.textContent = 'ë‚œì´ë„: ' + story.diff;
  els.play.time.textContent = 'ì†Œìš”: ' + story.time;
  els.play.reward.textContent = 'ë³´ìƒ: ' + story.reward;
  els.play.desc.textContent = story.desc;
  els.play.thumb.style.background = `url('${story.thumb}') center/cover no-repeat`;
  els.play.badge.textContent = state.progress[story.id] ? 'REPLAY' : 'STORY';
  els.play.steps.innerHTML = '';
  story.steps.forEach((st, idx)=>{
    const box = document.createElement('div');
    box.className = 'card';
    box.style.flex = '1 1 320px';
    box.innerHTML = `
      <b>${idx+1}. ${st.title}</b>
      <div class="row" style="margin-top:8px">
        <button class="success" data-choose="A">${st.a}</button>
        <button class="ghost" data-choose="B">${st.b}</button>
      </div>
      <p class="muted" data-msg style="min-height:20px; margin-top:8px"></p>
    `;
    const msg = box.querySelector('[data-msg]');
    box.querySelector('[data-choose="A"]').addEventListener('click', ()=>{
      msg.textContent = st.aMsg || 'ì¢‹ì€ ì„ íƒ!';
      reward(3, 'ì„ íƒ ë³´ìƒ');
    });
    box.querySelector('[data-choose="B"]').addEventListener('click', ()=>{
      msg.textContent = st.bMsg || 'ë¬´ë‚œí•œ ì„ íƒâ€¦';
      reward(1, 'ì†ŒëŸ‰ ë³´ìƒ');
    });
    els.play.steps.appendChild(box);
  });
  els.play.start.disabled = false;
  els.play.complete.disabled = true;
  switchScreen('module','play');
}

els.play.start.addEventListener('click', ()=>{
  if(!state.currentStory){ return; }
  toast('ìŠ¤í† ë¦¬ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ê° ë‹¨ê³„ì˜ ì„ íƒìœ¼ë¡œ ë³´ìƒì„ ë°›ìŠµë‹ˆë‹¤.');
  els.play.start.disabled = true;
  els.play.complete.disabled = false;
});

els.play.complete.addEventListener('click', ()=>{
  if(!state.currentStory){ return; }
  state.progress[state.currentStory.id] = true;
  reward(10, state.currentStory.reward, true);
  logQuest(`ã€${state.currentStory.title}ã€ ì™„ë£Œ! ë³´ìƒ: ${state.currentStory.reward} Â· í¬ì¸íŠ¸ +10`);
  toast('ìŠ¤í† ë¦¬ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.');
  switchScreen('play','module');
  // ëª©ë¡ ê°±ì‹ 
  renderStories(DB[state.currentModule].stories);
});

/* ===== ë³´ìƒ ì²˜ë¦¬ ===== */
function reward(pts=1, item='ì½”ì¸', important=false){
  state.points += pts;
  if(item){ state.items.push(item); }
  hudUpdate();
  if(important) toast(`ğŸ ë³´ìƒ íšë“: ${item} Â· +${pts}p`);
}

/* ===== ì§„ì… ê°€ë“œ & ê¸°ë³¸ ëª¨ë“ˆ ì„ íƒ ===== */
document.addEventListener('click', (e)=>{
  if(!state.loggedIn && e.target.closest('#moduleScreen, #playScreen')){
    e.preventDefault(); e.stopPropagation();
    alert('ë¨¼ì € ë¡œê·¸ì¸ ë° Pi ê²°ì œë¥¼ ì™„ë£Œí•˜ì„¸ìš”. Ï€');
  }
}, true);

// ì²« ëª¨ë“ˆ í”„ë¦¬ë¡œë“œ
loadModule('romance');

/* ===== ì´ˆê¸° HUD ===== */
hudUpdate();
setStatus('ìƒíƒœ: ëŒ€ê¸° ì¤‘');
</script>
</body>
</html>
