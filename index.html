<script>
// ê¸°ì¡´ ì ìˆ˜/ì•„ì´í…œ ë³€ìˆ˜ ê·¸ëŒ€ë¡œ ìœ ì§€
let points = 0, items = [], piCoins = 0, currentModule = "", logMessages = [];

// ì ìˆ˜/ì•„ì´í…œ/ì½”ì¸ ì—…ë°ì´íŠ¸
function updateScore() {
  scoreEl.textContent = `í¬ì¸íŠ¸: ${points} | Piì½”ì¸: ${piCoins} | ì•„ì´í…œ: ${items.length ? items.join(", ") : "ì—†ìŒ"}`;
}

// í€˜ìŠ¤íŠ¸ ë¡œê·¸
function logQuest(msg) {
  logMessages.push(msg);
  questLog.innerHTML = logMessages.map(m => `â€¢ ${m}`).join("<br>");
}

// ëª¨ë“ˆ ì •ì˜ (ìŠ¤í† ë¦¬ + ì•„ë°”íƒ€ + ì†Œí’ˆ + Piì½”ì¸)
const modules = {
  love: {
    title: "ì—°ì•  ëª¨ë“ˆ",
    desc: "ê³µì›ì—ì„œ ìºë¦­í„°ì™€ ìƒí˜¸ìž‘ìš©í•˜ë©° ì—°ì•  ì²´í—˜! í•˜íŠ¸ì™€ Pi ì½”ì¸ì„ ëª¨ì•„ë³´ì„¸ìš”.",
    sky: "#FFC0CB",
    avatars: [
      {type:"box", pos:"-1 1 -3", color:"#FF69B4", log:"ðŸ’Œ ìºë¦­í„°1 ëŒ€í™” ì™„ë£Œ! +10ì , 0.5 Piì½”ì¸, í•˜íŠ¸ íšë“", points:10, pi:0.5, item:"í•˜íŠ¸", anim:true},
      {type:"box", pos:"1 1 -3", color:"#FF1493", log:"ðŸ’Œ ìºë¦­í„°2 ëŒ€í™” ì™„ë£Œ! +10ì , 0.5 Piì½”ì¸, í•˜íŠ¸ íšë“", points:10, pi:0.5, item:"í•˜íŠ¸", anim:true}
    ],
    props: [
      {type:"cone", pos:"0 0 -4", color:"#FFB6C1", height:1, radius:0.5, log:"ðŸŒ¸ ê½ƒ ê´€ì°° ì™„ë£Œ! +5ì , 0.2 Piì½”ì¸, ê½ƒ íšë“", points:5, pi:0.2, item:"ê½ƒ", anim:true},
      {type:"sphere", pos:"0 2 -5", color:"#FFD700", radius:0.3, log:"ðŸŽ ì„ ë¬¼ ë°œê²¬! +20ì , 1 Piì½”ì¸, ì´ˆì½” íšë“", points:20, pi:1, item:"ì´ˆì½”", anim:true}
    ]
  },
  space: {
    title:"ìš°ì£¼ì²´í—˜ ëª¨ë“ˆ",
    desc:"íƒì‚¬ì„  íƒ‘ìŠ¹ â†’ í–‰ì„± íƒí—˜ â†’ ì§€ë„ì™€ Piì½”ì¸ ìˆ˜ì§‘!",
    sky:"#000022",
    avatars:[
      {type:"sphere", pos:"-1 1.5 -4", color:"#FFA500", log:"ðŸª í–‰ì„±1 íƒí—˜ ì™„ë£Œ! +15ì , 1 Piì½”ì¸, ì§€ë„ íšë“", points:15, pi:1, item:"í–‰ì„± ì§€ë„", anim:true},
      {type:"sphere", pos:"1 2 -5", color:"#00FFFF", log:"ðŸª í–‰ì„±2 íƒí—˜ ì™„ë£Œ! +15ì , 1 Piì½”ì¸, ì§€ë„ íšë“", points:15, pi:1, item:"í–‰ì„± ì§€ë„", anim:true}
    ],
    props:[
      {type:"box", pos:"0 1 -6", color:"#8A2BE2", depth:0.5, height:0.5, width:0.5, log:"ðŸŽ ë³´ë„ˆìŠ¤ ë°œê²¬! +25ì , 2 Piì½”ì¸, ìš°ì£¼ ìž¥ë¹„ íšë“", points:25, pi:2, item:"ìš°ì£¼ ìž¥ë¹„", anim:true}
    ]
  },
  hobby: {
    title:"ì·¨ë¯¸ ëª¨ë“ˆ",
    desc:"ìˆ²ì† ì‚°ì±…ê³¼ ì·¨ë¯¸ í™œë™ VR ì²´í—˜! ê½ƒ, ì»¤í”¼, Piì½”ì¸ì„ ìˆ˜ì§‘í•˜ì„¸ìš”.",
    sky:"#A0E0A0",
    avatars:[
      {type:"cone", pos:"-1 0.5 -3", color:"#228B22", height:2, radius:0.5, log:"ðŸŒ³ ê½ƒ ê´€ì°° ì™„ë£Œ! +5ì , 0.2 Piì½”ì¸, ê½ƒ íšë“", points:5, pi:0.2, item:"ê½ƒ", anim:true},
      {type:"box", pos:"1 0.3 -3", color:"#8B4513", depth:0.5, height:0.5, width:2, log:"ðŸª‘ ë²¤ì¹˜ íœ´ì‹ ì™„ë£Œ! +5ì , 0.2 Piì½”ì¸, ì»¤í”¼ íšë“", points:5, pi:0.2, item:"ì»¤í”¼", anim:true}
    ],
    props:[
      {type:"sphere", pos:"0 1.5 -4", color:"#FF4500", radius:0.3, log:"ðŸŽ ë³´ë„ˆìŠ¤ ì—´ë§¤ ë°œê²¬! +15ì , 0.5 Piì½”ì¸, ì—´ë§¤ íšë“", points:15, pi:0.5, item:"ì—´ë§¤", anim:true}
    ]
  }
};

// VR ëª¨ë“ˆ ì‹œìž‘ ì‹œ
startVRBtn.addEventListener("click", ()=>{
  moduleScreen.style.display="none";
  vrScreen.style.display="flex";
  moduleContent.innerHTML="";
  points=0; items=[]; piCoins=0; updateScore();
  logMessages=[]; questLog.innerHTML="";

  const mod = modules[currentModule];
  vrSky.setAttribute("color", mod.sky);

  // ì•„ë°”íƒ€ ìƒì„±
  mod.avatars.forEach(obj=>{
    const el = document.createElement(`a-${obj.type}`);
    el.setAttribute("position", obj.pos);
    el.setAttribute("color", obj.color);
    if(obj.type==="box"){ el.setAttribute("depth","1"); el.setAttribute("height","2"); el.setAttribute("width","1"); }
    if(obj.type==="cone"){ el.setAttribute("height",obj.height); el.setAttribute("radius-bottom",obj.radius); }
    if(obj.type==="sphere"){ el.setAttribute("radius",obj.radius||1); }
    if(obj.anim){ el.setAttribute("animation__hover","property=rotation;to=0 360 0;loop=true;dur=4000;easing=linear"); }
    el.addEventListener("click", ()=>{
      points+=obj.points; piCoins+=obj.pi; items.push(obj.item); updateScore();
      logQuest(obj.log);
      el.setAttribute("animation__click","property=rotation;to=0 720 0;dur=1000;easing=linear");
    });
    moduleContent.appendChild(el);
  });

  // ì†Œí’ˆ ìƒì„±
  mod.props.forEach(obj=>{
    const el = document.createElement(`a-${obj.type}`);
    el.setAttribute("position", obj.pos);
    el.setAttribute("color", obj.color);
    if(obj.height) el.setAttribute("height", obj.height);
    if(obj.radius) el.setAttribute("radius-bottom", obj.radius);
    if(obj.depth) el.setAttribute("depth", obj.depth);
    if(obj.width) el.setAttribute("width", obj.width);
    if(obj.anim){ el.setAttribute("animation__hover","property=rotation;to=0 360 0;loop=true;dur=4000;easing=linear"); }
    el.addEventListener("click", ()=>{
      points+=obj.points; piCoins+=obj.pi; items.push(obj.item); updateScore();
      logQuest(obj.log);
      el.setAttribute("animation__click","property=rotation;to=0 720 0;dur=1000;easing=linear");
    });
    moduleContent.appendChild(el);
  });
});
</script>
