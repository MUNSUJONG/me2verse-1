<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Me2Verse ëª°ì…í˜• SPA</title>
<style>
body { font-family: Arial; margin:0; padding:0; background:#f0f4f8; display:flex; flex-direction:column; align-items:center; }
h1 { color:#e74c3c; margin:10px 0; text-align:center; }
#levelContainer { width:90%; background:#ddd; border-radius:10px; margin:10px auto; height:25px; overflow:hidden; }
#levelBar { height:25px; width:0%; background:#f39c12; text-align:center; color:#fff; line-height:25px; transition:width 0.5s; font-weight:bold; }
#moduleButtons { display:flex; flex-wrap:wrap; justify-content:center; margin-top:10px; }
.button { margin:6px; padding:12px 20px; font-size:16px; color:#fff; background:#3498db; border:none; border-radius:8px; cursor:pointer; flex:1; min-width:120px; transition:0.2s; }
.button:hover { background:#2980b9; }
.module { display:none; padding:20px; margin:20px auto; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.2); max-width:600px; width:90%; position:relative; background:#fff; }
.chat-box { border:1px solid #ccc; padding:10px; height:300px; overflow-y:auto; border-radius:10px; background:#fefefe; margin-bottom:10px; }
.message { margin:6px 0; padding:8px 12px; border-radius:12px; max-width:80%; clear:both; }
.message.ai { background:#3498db; color:#fff; float:left; }
.message.user { background:#2ecc71; color:#fff; float:right; }
#userInput { width:calc(100% - 100px); padding:10px; border-radius:8px; border:1px solid #ccc; font-size:16px; }
#sendBtn { padding:10px 16px; border:none; border-radius:8px; background:#e67e22; color:#fff; cursor:pointer; transition:0.2s; }
#sendBtn:hover { background:#d35400; }
.backBtn { background:#16a085; margin-top:10px; }
.backBtn:hover { background:#0e6655; }
</style>
</head>
<body>

<h1>ğŸš€ Me2Verse ëª°ì…í˜• ì²´í—˜ SPA</h1>
<div id="levelContainer">
  <div id="levelBar">ë ˆë²¨ 1 (0 XP)</div>
</div>

<div id="moduleButtons">
  <button class="button" onclick="showModule('love')">â¤ï¸ ì—°ì• </button>
  <button class="button" onclick="showModule('marriage')">ğŸ’ ê²°í˜¼</button>
  <button class="button" onclick="showModule('hobby')">ğŸ¨ ì·¨ë¯¸</button>
  <button class="button" onclick="showModule('space')">ğŸŒŒ ìš°ì£¼</button>
</div>

<div id="moduleContainer"></div>

<script>
// ë ˆë²¨/XP
let level = 1, xp = 0, currentModule='', currentNode='';
const xpPerLevel = 20;
function updateLevelBar(){
  let percent = (xp % xpPerLevel)/xpPerLevel*100;
  document.getElementById('levelBar').style.width = percent + '%';
  document.getElementById('levelBar').textContent = `ë ˆë²¨ ${level} (${xp} XP)`;
}
function addXP(amount){
  xp += amount;
  if(xp >= level*xpPerLevel){
    level++;
    alert(`ğŸ‰ ë ˆë²¨ì—…! ë ˆë²¨ ${level} ë‹¬ì„±!`);
  }
  updateLevelBar();
}

// ëª¨ë“ˆë³„ ìŠ¤í† ë¦¬/ë°°ê²½/AI
const modulesData = {
  love: {
    aiName:"ì—°ì¸ AI",
    background:"https://picsum.photos/id/1015/600/300",
    storyTree:{
      start:{ text:"ë°ì´íŠ¸ ì¥ì†Œë¥¼ ì„ íƒí•˜ì„¸ìš”.", options:{ ì¹´í˜:{text:"â˜• ì¹´í˜ì—ì„œ ë°ì´íŠ¸ ì‹œì‘!", next:"conversation", xp:5}, ê³µì›:{text:"ğŸŒ³ ê³µì›ì—ì„œ ì‚°ì±… ì‹œì‘!", next:"conversation", xp:5} } },
      conversation:{ text:"ëŒ€í™” ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”.", options:{ ì˜í™”:{text:"ğŸ¬ ì˜í™” ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ´ìŠµë‹ˆë‹¤.", next:"end", xp:5}, ìŒì•…:{text:"ğŸµ ìŒì•… ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ´ìŠµë‹ˆë‹¤.", next:"end", xp:5} } },
      end:{ text:"ë°ì´íŠ¸ê°€ ì¦ê±°ì› ìŠµë‹ˆë‹¤! ğŸ‰", xp:10 }
    }
  },
  marriage: {
    aiName:"ì›¨ë”© í”Œë˜ë„ˆ AI",
    background:"https://picsum.photos/id/1016/600/300",
    storyTree:{
      start:{ text:"ì‹ì¥ ìŠ¤íƒ€ì¼ ì„ íƒ:", options:{ ì „í†µì‹:{text:"ğŸ¯ ì „í†µì‹ ì¤€ë¹„ ì™„ë£Œ!", next:"dress", xp:10}, í˜„ëŒ€ì‹:{text:"ğŸ° í˜„ëŒ€ì‹ ì¤€ë¹„ ì™„ë£Œ!", next:"dress", xp:10} } },
      dress:{ text:"ë“œë ˆìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”.", options:{ í™”ì´íŠ¸:{text:"ğŸ‘° í™”ì´íŠ¸ ë“œë ˆìŠ¤ ì„ íƒ!", next:"end", xp:5}, í•‘í¬:{text:"ğŸŒ¸ í•‘í¬ ë“œë ˆìŠ¤ ì„ íƒ!", next:"end", xp:5} } },
      end:{ text:"ê²°í˜¼ì‹ ì¤€ë¹„ ì™„ë£Œ! ğŸ‰", xp:10 }
    }
  },
  hobby: {
    aiName:"ì·¨ë¯¸ ë©˜í†  AI",
    background:"https://picsum.photos/id/1025/600/300",
    storyTree:{
      start:{ text:"ì·¨ë¯¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.", options:{ ê·¸ë¦¼:{text:"ğŸ–Œï¸ ê·¸ë¦¼ ê·¸ë¦¬ê¸° ì‹œì‘!", next:"practice", xp:3}, ì•…ê¸°:{text:"ğŸ¹ ì•…ê¸° ë°°ìš°ê¸° ì‹œì‘!", next:"practice", xp:3} } },
      practice:{ text:"ì—°ìŠµì„ ì™„ë£Œí–ˆë‚˜ìš”?", options:{ yes:{text:"ì—°ìŠµ ì™„ë£Œ! ğŸ‘", next:"end", xp:5}, no:{text:"ë” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.", next:"practice", xp:2} } },
      end:{ text:"ì·¨ë¯¸ ì²´í—˜ ì™„ë£Œ! ğŸ‰", xp:5 }
    }
  },
  space: {
    aiName:"ìš°ì£¼ì„  AI",
    background:"https://picsum.photos/id/1020/600/300",
    storyTree:{
      start:{ text:"ëª©í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”.", options:{ ë‹¬:{text:"ğŸŒ• ë‹¬ íƒì‚¬ ì‹œì‘!", next:"mission", xp:8}, í™”ì„±:{text:"ğŸª í™”ì„± íƒì‚¬ ì‹œì‘!", next:"mission", xp:8} } },
      mission:{ text:"ì¥ë¹„ë¥¼ ì ê²€í•˜ê³  ì§„í–‰í•˜ì„¸ìš”.", options:{ ì ê²€ì™„ë£Œ:{text:"âœ… ì¥ë¹„ ì ê²€ ì™„ë£Œ!", next:"end", xp:5}, ì ê²€ë¯¸ì™„ë£Œ:{text:"âš ï¸ ì¥ë¹„ ì ê²€ í•„ìš”!", next:"mission", xp:2} } },
      end:{ text:"ë¯¸ì…˜ ì™„ë£Œ! ğŸš€", xp:10 }
    }
  }
};

// SPA ë¡œì§
function showModule(id){
  currentModule = id;
  currentNode = 'start';
  renderModule();
}
function backToMain(){
  currentModule = '';
  document.getElementById('moduleContainer').innerHTML = '';
}

// ë©”ì‹œì§€ ì¶”ê°€
function addMessage(sender,text){
  const chatBox = document.getElementById('chatBox');
  const div = document.createElement('div');
  div.className = 'message '+sender;
  div.textContent = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// ì‚¬ìš©ì ì…ë ¥ ë¶„ì„ â†’ ì˜µì…˜ ìë™ ì„ íƒ
function analyzeInput(userText){
  const options = modulesData[currentModule].storyTree[currentNode].options;
  const keywords = Object.keys(options);
  for(let kw of keywords){
    if(userText.includes(kw)) return kw;
  }
  return keywords[Math.floor(Math.random()*keywords.length)];
}

// ì…ë ¥ ì²˜ë¦¬
function handleUserInput(){
  const inputBox = document.getElementById('userInput');
  if(!inputBox.value) return;
  addMessage('user', inputBox.value);
  const chosenOption = analyzeInput(inputBox.value);
  setTimeout(()=>chooseOption(chosenOption),500);
  inputBox.value = '';
}

// ëª¨ë“ˆ ë Œë”ë§
function renderModule(){
  const data = modulesData[currentModule];
  const node = data.storyTree[currentNode];
  const container = document.getElementById('moduleContainer');
  container.innerHTML = `
    <div class="module" style="display:block;">
      <img src="${data.background}" style="width:100%; border-radius:12px; margin-bottom:10px;">
      <div class="chat-box" id="chatBox"></div>
      <input type="text" id="userInput" placeholder="AIì—ê²Œ ë§í•´ë³´ì„¸ìš”...">
      <button class="button" id="sendBtn">ë³´ë‚´ê¸°</button>
      <div id="optionsDiv"></div>
      <button class="button backBtn" onclick="backToMain()">ë©”ì¸ìœ¼ë¡œ</button>
    </div>
  `;
  document.getElementById('sendBtn').onclick = handleUserInput;
  addMessage('ai', `${data.aiName}: ${node.text}`);
  const optionsDiv = document.getElementById('optionsDiv');
  if(node.options){
    Object.keys(node.options).forEach(opt=>{
      const btn = document.createElement('button');
      btn.className='button';
      btn.textContent = opt;
      btn.onclick = ()=>chooseOption(opt);
      optionsDiv.appendChild(btn);
    });
  }else addXP(node.xp);
}

// ì˜µì…˜ ì„ íƒ
function chooseOption(opt){
  const data = modulesData[currentModule];
  const node = data.storyTree[current
