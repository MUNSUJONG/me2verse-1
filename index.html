<script>
// 기존 점수/아이템 변수 그대로 유지
let points = 0, items = [], piCoins = 0, currentModule = "", logMessages = [];

// 점수/아이템/코인 업데이트
function updateScore() {
  scoreEl.textContent = `포인트: ${points} | Pi코인: ${piCoins} | 아이템: ${items.length ? items.join(", ") : "없음"}`;
}

// 퀘스트 로그
function logQuest(msg) {
  logMessages.push(msg);
  questLog.innerHTML = logMessages.map(m => `• ${m}`).join("<br>");
}

// 모듈 정의 (스토리 + 아바타 + 소품 + Pi코인)
const modules = {
  love: {
    title: "연애 모듈",
    desc: "공원에서 캐릭터와 상호작용하며 연애 체험! 하트와 Pi 코인을 모아보세요.",
    sky: "#FFC0CB",
    avatars: [
      {type:"box", pos:"-1 1 -3", color:"#FF69B4", log:"💌 캐릭터1 대화 완료! +10점, 0.5 Pi코인, 하트 획득", points:10, pi:0.5, item:"하트", anim:true},
      {type:"box", pos:"1 1 -3", color:"#FF1493", log:"💌 캐릭터2 대화 완료! +10점, 0.5 Pi코인, 하트 획득", points:10, pi:0.5, item:"하트", anim:true}
    ],
    props: [
      {type:"cone", pos:"0 0 -4", color:"#FFB6C1", height:1, radius:0.5, log:"🌸 꽃 관찰 완료! +5점, 0.2 Pi코인, 꽃 획득", points:5, pi:0.2, item:"꽃", anim:true},
      {type:"sphere", pos:"0 2 -5", color:"#FFD700", radius:0.3, log:"🎁 선물 발견! +20점, 1 Pi코인, 초코 획득", points:20, pi:1, item:"초코", anim:true}
    ]
  },
  space: {
    title:"우주체험 모듈",
    desc:"탐사선 탑승 → 행성 탐험 → 지도와 Pi코인 수집!",
    sky:"#000022",
    avatars:[
      {type:"sphere", pos:"-1 1.5 -4", color:"#FFA500", log:"🪐 행성1 탐험 완료! +15점, 1 Pi코인, 지도 획득", points:15, pi:1, item:"행성 지도", anim:true},
      {type:"sphere", pos:"1 2 -5", color:"#00FFFF", log:"🪐 행성2 탐험 완료! +15점, 1 Pi코인, 지도 획득", points:15, pi:1, item:"행성 지도", anim:true}
    ],
    props:[
      {type:"box", pos:"0 1 -6", color:"#8A2BE2", depth:0.5, height:0.5, width:0.5, log:"🎁 보너스 발견! +25점, 2 Pi코인, 우주 장비 획득", points:25, pi:2, item:"우주 장비", anim:true}
    ]
  },
  hobby: {
    title:"취미 모듈",
    desc:"숲속 산책과 취미 활동 VR 체험! 꽃, 커피, Pi코인을 수집하세요.",
    sky:"#A0E0A0",
    avatars:[
      {type:"cone", pos:"-1 0.5 -3", color:"#228B22", height:2, radius:0.5, log:"🌳 꽃 관찰 완료! +5점, 0.2 Pi코인, 꽃 획득", points:5, pi:0.2, item:"꽃", anim:true},
      {type:"box", pos:"1 0.3 -3", color:"#8B4513", depth:0.5, height:0.5, width:2, log:"🪑 벤치 휴식 완료! +5점, 0.2 Pi코인, 커피 획득", points:5, pi:0.2, item:"커피", anim:true}
    ],
    props:[
      {type:"sphere", pos:"0 1.5 -4", color:"#FF4500", radius:0.3, log:"🎁 보너스 열매 발견! +15점, 0.5 Pi코인, 열매 획득", points:15, pi:0.5, item:"열매", anim:true}
    ]
  }
};

// VR 모듈 시작 시
startVRBtn.addEventListener("click", ()=>{
  moduleScreen.style.display="none";
  vrScreen.style.display="flex";
  moduleContent.innerHTML="";
  points=0; items=[]; piCoins=0; updateScore();
  logMessages=[]; questLog.innerHTML="";

  const mod = modules[currentModule];
  vrSky.setAttribute("color", mod.sky);

  // 아바타 생성
  mod.avatars.forEach(obj=>{
    const el = document.createElement(`a-${obj.type}`);
    el.setAttribute("position", obj.pos);
    el.setAttribute("color", obj.color);
    if(obj.type==="box"){ el.setAttribute("depth","1"); el.setAttribute("height","2"); el.setAttribute("width","1"); }
    if(obj.type==="cone"){ el.setAttribute("height",obj.height); el.setAttribute("radius-bottom",obj.radius); }
    if(obj.type==="sphere"){ el.setAttribute("radius",obj.radius||1); }
    if(obj.anim){ el.setAttribute("animation__hover","property=rotation;to=0 360 0;loop=true;dur=4000;easing=linear"); }
    el.addEventListener("click", ()=>{
      points+=obj.points; piCoins+=obj.pi; items.push(obj.item); updateScore();
      logQuest(obj.log);
      el.setAttribute("animation__click","property=rotation;to=0 720 0;dur=1000;easing=linear");
    });
    moduleContent.appendChild(el);
  });

  // 소품 생성
  mod.props.forEach(obj=>{
    const el = document.createElement(`a-${obj.type}`);
    el.setAttribute("position", obj.pos);
    el.setAttribute("color", obj.color);
    if(obj.height) el.setAttribute("height", obj.height);
    if(obj.radius) el.setAttribute("radius-bottom", obj.radius);
    if(obj.depth) el.setAttribute("depth", obj.depth);
    if(obj.width) el.setAttribute("width", obj.width);
    if(obj.anim){ el.setAttribute("animation__hover","property=rotation;to=0 360 0;loop=true;dur=4000;easing=linear"); }
    el.addEventListener("click", ()=>{
      points+=obj.points; piCoins+=obj.pi; items.push(obj.item); updateScore();
      logQuest(obj.log);
      el.setAttribute("animation__click","property=rotation;to=0 720 0;dur=1000;easing=linear");
    });
    moduleContent.appendChild(el);
  });
});
</script>
