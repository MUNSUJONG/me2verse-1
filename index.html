<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>Me2Verse — 감성형 스토리 / 사용자제안 반영 데모</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{--bg:#f7f8fc;--card:#fff;--muted:#6b7280;--brand:#6C5CE7;--ok:#16a34a}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;background:var(--bg);color:#111}
  .app{max-width:1100px;margin:20px auto;padding:16px}
  .flags{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .flags img{width:88px}
  .hud{position:fixed;left:50%;transform:translateX(-50%);top:10px;background:rgba(255,255,255,0.9);padding:8px 12px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.08);z-index:50}
  .score{position:fixed;left:50%;transform:translateX(-50%);bottom:12px;background:rgba(0,0,0,.7);color:#fff;padding:8px 12px;border-radius:10px;z-index:50}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 20px rgba(0,0,0,.04)}
  input,select,textarea,button{font-size:15px;padding:10px;border-radius:8px;border:1px solid #e6e9f2}
  button{background:var(--brand);color:#fff;border:none;cursor:pointer}
  .ghost{background:transparent;border:1px solid #e6e9f2;color:var(--muted)}
  .modules{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px}
  .story{display:flex;flex-direction:column;gap:8px;border-radius:10px;overflow:hidden}
  .thumb{height:120px;background:#e6e9ff;background-size:cover;background-position:center;display:flex;align-items:flex-start;justify-content:flex-end;padding:10px}
  .tag{background:rgba(255,255,255,.9);padding:6px 8px;border-radius:999px;font-weight:700;color:var(--brand)}
  .chips{display:flex;gap:6px;flex-wrap:wrap}
  .chip{background:#f1f5f9;padding:6px 8px;border-radius:999px;font-size:13px;color:var(--muted)}
  .play-area{margin-top:12px}
  .step{margin-bottom:10px}
  .quest-log{position:fixed;right:12px;bottom:84px;width:320px;max-height:50vh;overflow:auto;z-index:45}
  .submission-form{display:grid;gap:8px}
  .admin-panel{position:fixed;left:12px;top:12px;width:320px;max-height:80vh;overflow:auto;z-index:60}
  .small{font-size:13px;color:var(--muted)}
  .pill{padding:6px 8px;border-radius:999px;background:#eef2ff;color:var(--brand);font-weight:700}
</style>
</head>
<body>
  <div class="hud card" id="status">상태: 대기 중</div>
  <div class="score card" id="score">포인트: <b id="scorePts">0</b> | 아이템: <span id="scoreItems">없음</span> | 결제: π (Pi)</div>

  <div class="app">
    <div class="flags">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg" alt="태극기 L">
      <div style="text-align:center">
        <h1 style="margin:0">Me2Verse — 감성형 제2의 삶</h1>
        <div class="small">기쁘고 즐겁고 흥분되는 스토리, 호기심이 지속되는 경험을 지향합니다</div>
      </div>
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg" alt="태극기 R">
    </div>

    <!-- 로그인/결제 (변경금지) -->
    <div class="card row" style="align-items:center">
      <input id="username" placeholder="유저 이름 입력" />
      <select id="amount">
        <option value="1">1 Pi</option><option value="5">5 Pi</option><option value="10">10 Pi</option>
      </select>
      <button id="autoBtn">자동 로그인 + Pi 결제</button>
      <div style="margin-left:auto" class="small">무료체험(일부) · 하이라이트 체험은 Pi 결제로 잠금해제</div>
    </div>

    <!-- 검색/필터 -->
    <div style="margin-top:12px" class="row">
      <input id="search" placeholder="스토리 검색 · 감정 태그로도 필터(예: 따뜻함, 설렘)" style="flex:1" />
      <select id="filter">
        <option value="all">모두</option><option value="free">무료</option><option value="paid">하이라이트(유료)</option>
      </select>
      <select id="sort">
        <option value="recommend">추천</option><option value="new">최신</option><option value="hot">인기</option>
      </select>
      <button id="myRecords" class="ghost">내 체험 기록 보기</button>
    </div>

    <!-- 모듈 스토리 그리드 -->
    <div id="modulesWrap" style="margin-top:12px" class="card">
      <h3 style="margin:6px 0">스토리 월드 — 모듈별 감성형 체험</h3>
      <div class="modules" id="storiesGrid"></div>
    </div>

    <!-- 플레이 영역 -->
    <div id="playWrap" class="card" style="margin-top:12px;display:none">
      <div class="row" style="align-items:center">
        <h3 id="playTitle" style="margin:4px 0"></h3>
        <div style="margin-left:auto" id="playMeta" class="small"></div>
      </div>
      <div id="playThumb" class="thumb" style="margin-top:6px"><div id="playTag" class="tag">STORY</div></div>
      <p id="playDesc" class="small"></p>
      <div id="stepsArea" class="play-area"></div>
      <div style="margin-top:10px" class="row">
        <button id="btnComplete" class="ghost">완료 처리 (보상 지급)</button>
        <button id="btnBack" class="ghost">목록으로</button>
      </div>
    </div>

    <!-- 제출 폼 -->
    <div class="card" style="margin-top:12px">
      <h3 style="margin:0 0 8px">스토리 제안하기 (사용자 제출)</h3>
      <form id="submission" class="submission-form">
        <input id="subTitle" placeholder="스토리 제목 (예: 비오는 날의 약속)" required />
        <textarea id="subSynopsis" placeholder="한줄 시놉시스(감성 중심)" rows="2"></textarea>
        <input id="subTags" placeholder="감정 태그(쉼표로 구분, 예: 따뜻함,설렘)" />
        <select id="subPremium"><option value="false">무료</option><option value="true">하이라이트(유료)</option></select>
        <div class="row">
          <button type="submit">제출</button>
          <div class="small" style="margin-left:auto">제안은 관리자 검토 후 반영됩니다</div>
        </div>
      </form>
    </div>

    <!-- 관리자 패널 (데모용, 로컬에서 열람/수락 가능) -->
    <div class="admin-panel card">
      <h4 style="margin:0 0 8px">관리자 검토(데모)</h4>
      <div id="submissionsList"></div>
      <hr/>
      <div class="small">관리자 도구: 제출을 수락하면 라이브 DB(프론트 엔드)에 즉시 반영됩니다.</div>
    </div>

    <!-- 퀘스트 로그 -->
    <div id="questLog" class="quest-log"></div>

  </div>

<script>
/* ===== 초기 데이터: 감성 스토리 세트 (모듈별 10개씩 일부 축약 버전 포함 - 전체는 구조대로 확장 가능) ===== */
const modulesStories = {
  romance: [
    { id:'romance_01', title:'첫눈의 재회', desc:'겨울, 첫눈 내리던 날 우연히 마주친 옛사랑과의 순간.', tags:['nostalgic','warm'], diff:'보통', time:8, isPremium:false, reward:{points:8,items:['폴라로이드']},
      steps:[
        {title:'인사하기', a:'미소로 다가간다', b:'먼저 말 걸기 어렵다', aMsg:'상대가 반갑게 웃습니다. 친밀도 +5', bMsg:'조금 어색하지만 기회는 남았습니다. 친밀도 +1', tag:'따뜻함'},
        {title:'카페 초대', a:'즉시 초대한다', b:'나중에 보자고 한다', aMsg:'대화가 길어지고 공감이 쌓입니다. +7', bMsg:'다음 만남 기회가 줄어듭니다. +0', tag:'희망'},
        {title:'마무리', a:'다음 약속을 잡는다', b:'연락처만 교환', aMsg:'관계가 확장됩니다. 특별 장면 잠금', bMsg:'기본 유지', tag:'설렘'}
      ]
    },
    /* ... romance_02 .. romance_10 (omitted for brevity in demo) */
  ],
  space: [
    { id:'space_01', title:'달 착륙의 새벽', desc:'달 표면에 첫 발을 내딛는 순간의 벅참.', tags:['awe','thrill'], diff:'보통', time:9, isPremium:true, reward:{points:20,items:['월석']},
      steps:[
        {title:'착륙 각도 조정', a:'정확히 조정한다', b:'보수적으로 접근', aMsg:'성공적으로 착륙! +10', bMsg:'착륙 중 흔들렸으나 안전함 +3', tag:'흥분'},
        {title:'도어 오픈', a:'신중히 오픈', b:'한 번에 빠르게', aMsg:'달의 냄새를 맡는 듯한 감동 +8', bMsg:'긴장감 있지만 생생한 체험 +6', tag:'경이'}
      ]
    },
    /* ... other space stories ... */
  ],
  hobby: [
    { id:'hobby_01', title:'숲속의 아침', desc:'새벽 숲에서 고요함을 느끼며 마음을 고요히 하는 시간', tags:['calm','healing'], diff:'쉬움', time:6, isPremium:false, reward:{points:6,items:['잎사귀']},
      steps:[
        {title:'숲길 걷기', a:'천천히 호흡한다', b:'빠르게 걷는다', aMsg:'마음이 잔잔해집니다. +3', bMsg:'에너지가 상승합니다. +2', tag:'힐링'}
      ]
    },
    /* ... */
  ],
  entertain: [
    /* ... */
  ],
  city: [
    /* ... */
  ]
};

/* ===== 유틸 / 상태 저장 (localStorage 기반 데모) ===== */
const STORE_KEYS = { EXPERIENCES:'mv_experiences_v1', SUBMISSIONS:'mv_submissions_v1', PROGRESS:'mv_progress_v1' };
let state = { user:null, points:0, items:[], experiences: load(STORE_KEYS.EXPERIENCES, []), submissions: load(STORE_KEYS.SUBMISSIONS, []), progress: load(STORE_KEYS.PROGRESS, {}) };

function load(k,def){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):def; }catch(e){return def;} }
function save(k,v){ localStorage.setItem(k,JSON.stringify(v)); }

/* ===== UI 요소 참조 ===== */
const statusEl = document.getElementById('status');
const scorePts = document.getElementById('scorePts');
const scoreItems = document.getElementById('scoreItems');
const storiesGrid = document.getElementById('storiesGrid');
const searchEl = document.getElementById('search');
const filterEl = document.getElementById('filter');
const sortEl = document.getElementById('sort');
const autoBtn = document.getElementById('autoBtn');
const usernameEl = document.getElementById('username');
const amountEl = document.getElementById('amount');
const playWrap = document.getElementById('playWrap');
const playTitle = document.getElementById('playTitle');
const playThumb = document.getElementById('playThumb');
const playDesc = document.getElementById('playDesc');
const stepsArea = document.getElementById('stepsArea');
const btnBack = document.getElementById('btnBack');
const btnComplete = document.getElementById('btnComplete');
const submissionsList = document.getElementById('submissionsList');
const submissionForm = document.getElementById('submission');
const myRecordsBtn = document.getElementById('myRecords');

/* ===== 초기 렌더 & 헬퍼 ===== */
function setStatus(msg){ statusEl.textContent = msg; }
function hudUpdate(){ scorePts.textContent = state.points; scoreItems.textContent = state.items.length? state.items.join(', '): '없음'; }
function toast(msg){ const t=document.createElement('div'); t.className='card'; t.style.marginBottom='8px'; t.textContent=msg; document.getElementById('appToast')?.remove(); document.body.insertAdjacentHTML('beforeend',`<div id="appToast" style="position:fixed;right:12px;top:12px;z-index:9999"></div>`); document.getElementById('appToast').appendChild(t); setTimeout(()=>t.remove(),2400); }

function renderAll(){
  // flatten module stories into array with module key
  let arr=[]; for(const mk in modulesStories){ modulesStories[mk].forEach(s=> arr.push(Object.assign({},s,{module:mk}))) }
  // filter
  const q=searchEl.value.trim().toLowerCase();
  if(q) arr = arr.filter(s=> s.title.toLowerCase().includes(q) || s.desc.toLowerCase().includes(q) || (s.tags && s.tags.join(' ').includes(q)));
  if(filterEl.value==='free') arr = arr.filter(s=> !s.isPremium);
  if(filterEl.value==='paid') arr = arr.filter(s=> s.isPremium);
  // TODO: sort logic
  // clear
  storiesGrid.innerHTML='';
  arr.forEach(story => {
    const div = document.createElement('div'); div.className='card story';
    div.innerHTML = `<div class="thumb" style="background-image:url('${story.thumb||('https://picsum.photos/seed/'+encodeURIComponent(story.title)+'/800/450')}')">
        <div class="tag">${story.isPremium? 'HIGHLIGHT (π)' : 'FREE'}</div></div>
      <div style="padding:8px 6px"><b>${story.title}</b><div class="small muted">${story.desc}</div>
      <div class="chips" style="margin-top:8px">
        <div class="chip">난이도:${story.diff||'보통'}</div>
        <div class="chip">소요:${story.time||8}분</div>
        <div class="chip">감정:${(story.tags||[]).join(', ')}</div>
      </div>
      <div class="row" style="margin-top:8px">
        <button data-play="${story.id}">시작</button>
        <button class="ghost" data-like="${story.id}">찜</button>
      </div></div>`;
    storiesGrid.appendChild(div);
    div.querySelector('[data-play]').addEventListener('click', ()=> tryOpenStory(story));
    div.querySelector('[data-like]').addEventListener('click', ()=> { toast('찜 등록 (데모)'); });
  });
}

/* ===== 로그인 + Pi 결제(시뮬레이션) — 기존 로직 유지 ===== */
autoBtn.addEventListener('click', ()=>{
  const user = usernameEl.value.trim(), amount = amountEl.value;
  if(!user){ alert('유저 이름 입력 필요!'); return; }
  setStatus(`상태: ${user} 로그인 중...`);
  setTimeout(()=> {
    setStatus(`상태: ${user} 로그인 성공! 🎉`);
    setStatus(`상태: ${amount} Pi 결제 처리 중...`);
    setTimeout(()=>{
      setStatus(`상태: ${user} 결제 완료! 💰`);
      alert(`${user}님의 ${amount} Pi 결제가 완료되었습니다!`);
      state.user = user;
      // welcome reward (demo)
      state.points += 5 * Number(amount);
      hudUpdate();
      renderAll();
      renderSubmissions();
    },1200);
  },800);
});

/* ===== 스토리 열기 — 유료일 경우 결제 유도 (시뮬레이션) ===== */
function tryOpenStory(story){
  if(story.isPremium){
    if(!state.user){ alert('하이라이트 체험은 로그인 및 Pi 결제가 필요합니다.'); return; }
    const ok = confirm(`"${story.title}"은 하이라이트(유료)입니다. ${story.reward?.points||10} 포인트 + 기념 아이템(유료)을 획득합니다.\n결제: ${prompt('결제 수량 π 입력 (예: 1)') || '취소'}`);
    if(!ok){ return; }
    // simulate payment success
  }
  openStory(story);
}

/* ===== 오픈 스토리: 플레이 UI 구성 ===== */
let currentStory = null;
function openStory(story){
  currentStory = story;
  playWrap.style.display = 'block';
  playTitle.textContent = story.title + ' · ' + (story.module||'');
  playDesc.textContent = story.desc;
  document.getElementById('playTag').textContent = story.isPremium? 'HIGHLIGHT':'STORY';
  playThumb.style.backgroundImage = `url('${story.thumb||('https://picsum.photos/seed/'+encodeURIComponent(story.title)+'/800/450')}')`;
  stepsArea.innerHTML = '';
  story.steps.forEach((st, idx)=>{
    const box = document.createElement('div'); box.className='card step';
    box.innerHTML = `<b>${idx+1}. ${st.title}</b>
      <div class="row" style="margin-top:8px">
        <button data-a>${st.a}</button>
        <button class="ghost" data-b>${st.b}</button>
      </div>
      <p class="small" data-msg style="min-height:18px;margin-top:6px"></p>`;
    const btnA = box.querySelector('[data-a]'), btnB = box.querySelector('[data-b]'), msg = box.querySelector('[data-msg]');
    btnA.addEventListener('click', ()=> { msg.textContent = st.aMsg; addRewardForChoice(st.aMsg, st.tag); btnA.disabled = true; btnB.disabled = true; });
    btnB.addEventListener('click', ()=> { msg.textContent = st.bMsg; addRewardForChoice(st.bMsg, st.tag); btnA.disabled = true; btnB.disabled = true; });
    stepsArea.appendChild(box);
  });
}

/* 보상 처리 (선택시 소소한 보상) */
function addRewardForChoice(msg, tag){
  // small reward logic: textual parsing for +N
  const m = (msg||'').match(/\+(\d+)/);
  let pts = m ? Number(m[1]) : 2;
  state.points += pts;
  // item heuristic
  if(msg.includes('하트')) state.items.push('하트');
  hudUpdate();
  logQuest(msg);
}

/* 퀘스트 로그 추가 */
function logQuest(txt){
  const el = document.createElement('div'); el.className='card'; el.style.marginBottom='8px'; el.innerHTML = `<b>퀘스트:</b> ${txt}`; document.getElementById('questLog').prepend(el);
}

/* 완료 처리 */
btnComplete.addEventListener('click', ()=>{
  if(!currentStory) return;
  // record experience
  const exp = { id: 'exp_'+Date.now(), user: state.user||'guest', storyId: currentStory.id, title: currentStory.title, timestamp: new Date().toISOString(), points: currentStory.reward?.points||10, items: currentStory.reward?.items||[] };
  state.experiences.unshift(exp); save(STORE_KEYS.EXPERIENCES, state.experiences);
  state.points += exp.points; state.items.push(...exp.items);
  hudUpdate(); logQuest(`스토리 완료: ${currentStory.title} · +${exp.points}p · 아이템:${exp.items.join(',')}`);
  alert('스토리 완료! 보상이 지급되었습니다.');
  // mark progress
  state.progress[currentStory.id] = true; save(STORE_KEYS.PROGRESS, state.progress);
  renderAll();
  // close play
  document.getElementById('playWrap').style.display='none';
  currentStory = null;
});

/* 뒤로가기 */
btnBack.addEventListener('click', ()=> { document.getElementById('playWrap').style.display='none'; currentStory=null; });

/* 제출 폼 */
submissionForm.addEventListener('submit', (ev)=>{
  ev.preventDefault();
  const t = document.getElementById('subTitle').value.trim();
  const s = document.getElementById('subSynopsis').value.trim();
  const tags = document.getElementById('subTags').value.split(',').map(x=>x.trim()).filter(Boolean);
  const isPremium = document.getElementById('subPremium').value === 'true';
  if(!t||!s){ alert('제목과 시놉시스는 필수입니다'); return; }
  const sub = { id:'sub_'+Date.now(), title:t, synopsis:s, tags, isPremium, status:'pending', submittedAt:new Date().toISOString() };
  state.submissions.unshift(sub); save(STORE_KEYS.SUBMISSIONS, state.submissions);
  renderSubmissions();
  alert('스토리 제안이 접수되었습니다. 관리자 검토 후 반영됩니다.');
  submissionForm.reset();
});

/* 관리 패널 렌더 */
function renderSubmissions(){
  submissionsList.innerHTML = '';
  if(!state.submissions.length){ submissionsList.innerHTML = '<div class="small">검토할 제출 없음</div>'; return; }
  state.submissions.forEach(sub=>{
    const d = document.createElement('div'); d.className='card'; d.style.marginBottom='8px';
    d.innerHTML = `<b>${sub.title}</b><div class="small">${sub.synopsis}</div><div class="small">태그:${sub.tags.join(', ')}</div><div style="margin-top:8px" class="row">
      <button data-accept="${sub.id}">수락</button><button class="ghost" data-reject="${sub.id}">거절</button>
    </div>`;
    submissionsList.appendChild(d);
    d.querySelector('[data-accept]').addEventListener('click', ()=> acceptSubmission(sub.id));
    d.querySelector('[data-reject]').addEventListener('click', ()=> rejectSubmission(sub.id));
  });
}

function acceptSubmission(id){
  const idx = state.submissions.findIndex(s=>s.id===id); if(idx<0) return;
  const sub = state.submissions.splice(idx,1)[0];
  // transform into story minimal shape and add to modulesStories['romance'] by default (or ask tag logic)
  const story = { id:'user_'+Date.now(), title:sub.title, desc:sub.synopsis, tags:sub.tags, diff:'보통', time:7, isPremium:sub.isPremium, reward:{points:8, items:['제안 보상']}, steps:[{title:'시작', a:'진행', b:'보류', aMsg:'+5', bMsg:'+1'}] };
  // Decide module by tag inference: if tags include 'space'->space else romance default
  let moduleKey = 'romance';
  if(sub.tags.map(t=>t.toLowerCase()).includes('space')) moduleKey='space';
  if(!modulesStories[moduleKey]) moduleKey='romance';
  modulesStories[moduleKey].unshift(story);
  save(STORE_KEYS.SUBMISSIONS, state.submissions);
  renderSubmissions(); renderAll();
  alert('제안을 수락하여 라이브 스토리에 반영했습니다.');
}

function rejectSubmission(id){
  const idx = state.submissions.findIndex(s=>s.id===id); if(idx<0) return;
  const sub = state.submissions[idx];
  if(!confirm(`제안 "${sub.title}"을(를) 거절하시겠습니까?`)) return;
  state.submissions.splice(idx,1); save(STORE_KEYS.SUBMISSIONS, state.submissions);
  renderSubmissions(); alert('제안 거절 처리되었습니다.');
}

/* 내 기록 열기 */
myRecordsBtn.addEventListener('click', ()=>{
  const ex = state.experiences;
  if(!ex.length){ alert('아직 체험 기록이 없습니다.'); return; }
  let msg = '내 체험 기록:\\n\\n';
  ex.slice(0,20).forEach(e=> msg += `${e.title} — ${new Date(e.timestamp).toLocaleString()} — +${e.points}p\\n`);
  alert(msg);
});

/* init */
function init(){
  // prepare thumbnail fallback for stories lacking thumb
  for(const mk in modulesStories){ modulesStories[mk].forEach(s => { if(!s.thumb) s.thumb = 'https://picsum.photos/seed/'+encodeURIComponent(s.title)+'/800/450'; }) }
  renderAll(); renderSubmissions(); hudUpdate();
}
init();

/* 보조: 저장 훅 (서버로 바꿀 수 있음) */
function saveExperience(exp){
  state.experiences.unshift(exp); save(STORE_KEYS.EXPERIENCES, state.experiences);
}
function saveSubmission(sub){ state.submissions.unshift(sub); save(STORE_KEYS.SUBMISSIONS, state.submissions); }

</script>
</body>
</html>
