<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Me2Verse â€“ Pi ì „ìš© ë©”íƒ€ë²„ìŠ¤ (ìŠ¤í† ë¦¬Â·ë¯¸ì…˜Â·VR)</title>

<!-- A-Frame -->
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

<style>
  :root{
    --brand:#6C4EFF; --ink:#1f2330; --muted:#6b7280; --bg:#f4f6fb; --card:#ffffff; --accent:#ff5a7a;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;color:var(--ink);background:var(--bg);}
  button,input,select{font:inherit}
  .shell{position:relative;min-height:100vh}
  .bar{position:sticky;top:0;z-index:20;background:var(--card);border-bottom:1px solid #e6e8ef;}
  .bar-inner{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:12px;padding:10px 16px}
  .flag-wrap{display:flex;gap:12px;margin-right:8px}
  .flag{width:44px;height:auto;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}
  .title{font-weight:800;letter-spacing:.2px}
  .pi-pill{margin-left:auto;display:flex;align-items:center;gap:6px;border:1px solid #e6e8ef;border-radius:999px;padding:6px 10px;background:#fff}
  .pi-icon{font-weight:900}
  .screen{max-width:1100px;margin:0 auto;padding:24px 16px;display:none}
  .screen.active{display:block}
  .card{background:var(--card);border:1px solid #e6e8ef;border-radius:16px;padding:18px;box-shadow:0 4px 12px rgba(17,22,31,.04)}
  .h1{font-size:28px;font-weight:800;margin:0 0 10px}
  .h2{font-size:22px;font-weight:800;margin:0 0 10px}
  .muted{color:var(--muted)}
  .row{display:flex;flex-wrap:wrap;gap:14px}
  .col{flex:1 1 320px}
  .input{width:100%;padding:12px 14px;border:1px solid #d4d7e2;border-radius:12px;background:#fff}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 14px;border:0;border-radius:12px;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
  .btn.secondary{background:#101828;color:#fff}
  .btn.ghost{background:#fff;color:#101828;border:1px solid #e6e8ef}
  .btn.link{background:transparent;color:var(--brand);padding:0}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #e6e8ef;background:#fff;font-size:12px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
  .mod{background:#fff;border:1px solid #e6e8ef;border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:10px}
  .mod h3{margin:0;font-size:18px}
  .progress{height:8px;background:#eef0f7;border-radius:999px;overflow:hidden}
  .progress > span{display:block;height:100%;background:linear-gradient(90deg,#6C4EFF,#AC59FF)}
  .story{background:#fbfbff;border:1px dashed #d6d9ef;border-radius:12px;padding:12px}
  .list{margin:8px 0 0 0;padding-left:18px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .footer{padding:16px;color:var(--muted);text-align:center}
  /* VR overlay buttons */
  .vr-hud{position:fixed;inset:0;pointer-events:none}
  .vr-top{position:absolute;top:10px;left:50%;transform:translateX(-50%);pointer-events:auto}
  .vr-right{position:absolute;top:10px;right:10px;display:flex;flex-direction:column;gap:8px;pointer-events:auto}
  .hud-btn{padding:10px 12px;border-radius:12px;border:1px solid #e6e8ef;background:#ffffffcc;backdrop-filter:blur(6px);cursor:pointer}
  .status-pill{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:8px 12px;border-radius:999px;font-size:13px}
  /* A-Frame container */
  #vrWrap{display:none;position:fixed;inset:0;background:#000;z-index:50}
  a-scene{width:100%;height:100%}
</style>
</head>
<body>
<div class="shell">

  <!-- Top Bar -->
  <div class="bar">
    <div class="bar-inner">
      <div class="flag-wrap">
        <img class="flag" src="https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg" alt="íƒœê·¹ê¸°(ì¢Œ)">
        <img class="flag" src="https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg" alt="íƒœê·¹ê¸°(ìš°)">
      </div>
      <div class="title">Me2Verse â€“ ê°ì„± ìŠ¤í† ë¦¬ ë©”íƒ€ë²„ìŠ¤</div>
      <div class="pi-pill" id="userPill"><span class="pi-icon">Ï€</span><span id="userNameLabel">ë¡œê·¸ì¸ í•„ìš”</span></div>
    </div>
  </div>

  <!-- ë¡œê·¸ì¸ (Pi ê³„ì • ì „ìš©) -->
  <section id="scr-login" class="screen active">
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="h1">Pi ê³„ì • ë¡œê·¸ì¸</div>
          <p class="muted">Pi Network ê³„ì • ID(ë‹‰ë„¤ì„ ë˜ëŠ” ì§€ê°‘ ì‹ë³„ì)ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ê²°ì œëŠ” í•„ìš” ì—†ìŠµë‹ˆë‹¤.</p>
          <input id="piId" class="input" placeholder="ì˜ˆ: pi_user_123" />
          <div class="chips">
            <span class="badge"><b>Ï€</b> Pi ì „ìš©</span>
            <span class="badge">ë°ì´í„° ë¡œì»¬ ë³´ì¡´</span>
            <span class="badge">ë¬´ë£Œ ì²´í—˜ í¬í•¨</span>
          </div>
          <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
            <button id="btnLogin" class="btn">ë¡œê·¸ì¸</button>
            <button id="btnDemo" class="btn ghost">ê²ŒìŠ¤íŠ¸ ì²´í—˜</button>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <div class="h2">ì•± ì†Œê°œ</div>
          <div class="story">
            <b>ê°ì„±í˜• ìŠ¤í† ë¦¬</b>ë¡œ ë‹¹ì‹ ì˜ ì œ2ì˜ ì‚¶ì„ ì„¤ê³„í•˜ì„¸ìš”.  
            ê° ëª¨ë“ˆì€ <b>ìŠ¤í† ë¦¬ â†’ ë¯¸ì…˜ â†’ í•˜ì´ë¼ì´íŠ¸ VR</b>ë¡œ êµ¬ì„±ë˜ë©°, ì›í•˜ëŠ” ìˆœê°„ì—ë§Œ VRì— ì§„ì…í•©ë‹ˆë‹¤.
          </div>
          <ul class="list">
            <li>ë¬´ë£Œì²´í—˜: ëª¨ë“  ëª¨ë“ˆì˜ ê¸°ë³¸ ìŠ¤í† ë¦¬ì™€ ë¯¸ì…˜ 1~2ê°œ</li>
            <li>í•˜ì´ë¼ì´íŠ¸ ì²´í—˜(ì˜ˆì•½ ìë¦¬): ì¶”í›„ Pi ê²°ì œ ì—°ë™ ì‹œ í•´ê¸ˆ</li>
            <li>ì§„í–‰ë„Â·ë°°ì§€: ìë™ ì €ì¥ (ë¸Œë¼ìš°ì € ë¡œì»¬)</li>
            <li>ìœ ì € ì œì•ˆ ìŠ¤í† ë¦¬: ì œì•ˆì„¼í„°ì—ì„œ ì œì¶œ â†’ ìš´ì˜íŒ€ ê²€í† /ë°˜ì˜</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- ëª¨ë“ˆ ì„ íƒ -->
  <section id="scr-mods" class="screen">
    <div class="card" style="margin-bottom:12px">
      <div class="h1">ëª¨ë“ˆ ì„ íƒ</div>
      <p class="muted">ì›í•˜ëŠ” ì„¸ê³„ë¥¼ ê³ ë¥´ì„¸ìš”. ìŠ¤í† ë¦¬ë¥¼ ë¨¼ì € ì½ê³ , ë¯¸ì…˜ì„ ìˆ˜í–‰í•œ ë’¤, ì›í•  ë•Œ VRë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
    </div>
    <div id="modsGrid" class="grid"></div>
  </section>

  <!-- ëª¨ë“ˆ ìƒì„¸(ìŠ¤í† ë¦¬/ë¯¸ì…˜) -->
  <section id="scr-detail" class="screen">
    <div class="row">
      <div class="col">
        <div class="card">
          <button class="btn link" id="backToMods">â† ëª¨ë“ˆ ëª©ë¡</button>
          <div class="h1" id="modTitle">ëª¨ë“ˆ ì œëª©</div>
          <p class="muted" id="modTagline">ëª¨ë“ˆ ë¶€ì œ</p>
          <div class="progress" title="ì§„í–‰ë„">
            <span id="modProgress" style="width:0%"></span>
          </div>
          <div class="chips" id="modBadges" style="margin-top:10px"></div>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <div class="h2">ìŠ¤í† ë¦¬</div>
          <div id="modStory" class="story"></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="h2">ë¯¸ì…˜</div>
      <div id="missionsList" class="grid"></div>
      <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
        <button id="btnStartVR" class="btn secondary">í•˜ì´ë¼ì´íŠ¸ VR ì‹œì‘</button>
        <button id="btnFreeTry" class="btn">ë¬´ë£Œì²´í—˜(ê¸€Â·ì´ë¯¸ì§€)</button>
        <button id="btnSuggest" class="btn ghost">ìŠ¤í† ë¦¬ ì œì•ˆí•˜ê¸°</button>
        <button id="btnHome" class="btn ghost">í™ˆ</button>
      </div>
    </div>
  </section>

  <!-- ì œì•ˆì„¼í„° -->
  <section id="scr-suggest" class="screen">
    <div class="card">
      <button class="btn link" id="backToDetail">â† ëª¨ë“ˆë¡œ ëŒì•„ê°€ê¸°</button>
      <div class="h1">ìœ ì € ìŠ¤í† ë¦¬ ì œì•ˆì„¼í„°</div>
      <p class="muted">ë‹¹ì‹ ì˜ ì•„ì´ë””ì–´ë¥¼ ë³´ë‚´ì£¼ì„¸ìš”. ìš´ì˜íŒ€ì´ ê²€í†  í›„ ë°˜ì˜í•©ë‹ˆë‹¤.</p>
      <div class="row">
        <div class="col">
          <textarea id="suggestText" class="input" rows="8" placeholder="ì˜ˆ) ë¯¸íˆ¬ ë·°í‹°ì— ì»¤ìŠ¤í…€ í–¥ìˆ˜ ì¡°í–¥ ìŠ¤í† ë¦¬ ì¶”ê°€í•´ì£¼ì„¸ìš”."></textarea>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="btnSubmitSuggest" class="btn">ì œì•ˆ ì œì¶œ</button>
            <button id="btnSuggestHome" class="btn ghost">í™ˆ</button>
          </div>
        </div>
        <div class="col">
          <div class="story">
            <b>ê°€ì´ë“œ</b><br/>
            Â· êµ¬ì²´ì ì¸ ìƒí™©/ì¥ì†Œ/ì¸ë¬¼/ë³´ìƒ ìš”ì†Œë¥¼ í¬í•¨í•˜ë©´ ì±„íƒ í™•ë¥  ìƒìŠ¹<br/>
            Â· ìš•ì„¤Â·í­ë ¥Â·ì°¨ë³„ì  ë‚´ìš©ì€ ë°˜ì˜ ë¶ˆê°€<br/>
            Â· ì±„íƒ ì‹œ, í”„ë¡œí•„ì— <b>Creator ë°°ì§€</b> ì§€ê¸‰
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- VR ì»¨í…Œì´ë„ˆ -->
  <div id="vrWrap">
    <a-scene id="scene" renderer="antialias:true">
      <a-entity light="type: ambient; intensity:0.7"></a-entity>
      <a-entity light="type: directional; intensity:0.8" position="1 2 1"></a-entity>
      <a-sky id="sky" color="#101625"></a-sky>
      <a-entity id="room"></a-entity>

      <!-- ì¹´ë©”ë¼ -->
      <a-entity id="rig" position="0 1.6 0">
        <a-camera wasd-controls look-controls>
          <a-cursor color="#fff"></a-cursor>
        </a-camera>
      </a-entity>
    </a-scene>

    <!-- VR HUD -->
    <div class="vr-hud">
      <div class="vr-right">
        <button class="hud-btn" id="btnVRBack">ë‚˜ê°€ê¸°</button>
        <button class="hud-btn" id="btnVRHint">íŒíŠ¸</button>
      </div>
      <div class="vr-top">
        <span class="badge" id="vrTitle">VR</span>
      </div>
      <div class="status-pill" id="vrStatus">ì¤€ë¹„ ì™„ë£Œ</div>
    </div>
  </div>

  <div class="footer">Â© Me2Verse Â· Pi ì „ìš© Â· ì§„í–‰ë„ëŠ” ë¸Œë¼ìš°ì €ì— ì•ˆì „ ì €ì¥</div>
</div>

<script>
/** =========================
 *  ë°ì´í„° ì •ì˜
 *  ========================= */
const MODULES = [
  {
    id:'love', name:'ë¯¸íˆ¬ ëŸ¬ë¸Œ', tagline:'ì²« ë§Œë‚¨ â†’ ë°ì´íŠ¸ â†’ ì•½ì† â†’ ê²°í˜¼ì‹ ë¦¬í—ˆì„¤',
    sky:'#ffeff4',
    story:`ëŸ¬ë¸Œíƒ€ìš´ì— ë§‰ ë„ì°©í–ˆìŠµë‹ˆë‹¤. ë‹¤ì •í•œ ì¹´í˜ ê±°ë¦¬ì™€ ë¶„ìˆ˜ê´‘ì¥ì´ ë‹¹ì‹ ì˜ ì„¤ë ˜ì„ í™˜ì˜í•´ìš”.
           ì˜…ì€ ì¬ì¦ˆê°€ íë¥´ê³ , ë°˜ì§ì´ëŠ” ê°€ë¡œë“± ì•„ë˜ì—ì„œ ì²« ëŒ€í™”ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.`,
    badges:['ê°ì„±','ì†Œì…œ','í•˜íŠ¸ìˆ˜ì§‘'],
    avatar: { // glTF ìƒ˜í”Œ â€“ ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ìì²´ ì•„ë°”íƒ€ ì‚¬ìš©
      src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/CesiumMan/glTF/CesiumMan.gltf',
      pos:'0 0 -3', scale:'0.8 0.8 0.8'
    },
    props:[
      {src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/WaterBottle/glTF/WaterBottle.gltf', pos:'-1 0 -2', scale:'0.6 0.6 0.6'},
      {src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/Avocado/glTF/Avocado.gltf', pos:'1 0 -2', scale:'0.7 0.7 0.7'}
    ],
    missions:[
      {id:'lv1', title:'ì²« ëŒ€í™”í•˜ê¸°', desc:'ë¶„ìˆ˜ëŒ€ ì• NPCì—ê²Œ ë‹¤ê°€ê°€ â€œì•ˆë…•â€ ì¸ì‚¬í•˜ê¸°', reward:'í•˜íŠ¸ +10'},
      {id:'lv2', title:'ë°ì´íŠ¸ ì œì•ˆ', desc:'ì¹´í˜ì—ì„œ ë¯¼íŠ¸ë¼ë–¼ 2ì” ì£¼ë¬¸í•˜ê¸°', reward:'í•˜íŠ¸ +20'},
      {id:'lv3', title:'ì•¼ê²½ ì‚°ì±…', desc:'ê°€ë¡œë“± 3ê³³ ì´¬ì˜í•˜ì—¬ ì•¨ë²” ë§Œë“¤ê¸°', reward:'í¬í† ë°°ì§€'},
      {id:'vr',  title:'í•˜ì´ë¼ì´íŠ¸ VR: í”„ëŸ¬í¬ì¦ˆ', desc:'ë£¨í”„íƒ‘ì—ì„œ ë°˜ì§ì´ëŠ” ì¡°ëª… ì•„ë˜ ì•½ì† ì„¸ìš°ê¸°', reward:'ì•½ì†ë°˜ì§€(ê¸°ë…)'}
    ]
  },
  {
    id:'enter', name:'ë¯¸íˆ¬ ì—”í„°', tagline:'ì—°ìŠµ Â· ì˜¤ë””ì…˜ Â· íŒ¬ë¯¸íŒ… Â· ê³µì—°',
    sky:'#0d0f1a',
    story:`ì—°ìŠµì‹¤ì˜ ê±°ìš¸ ì¡°ëª…ì´ ì¼œì¡ŒìŠµë‹ˆë‹¤. ë°•ìì™€ í˜¸í¡ì„ ë§ì¶”ë©° ë¬´ëŒ€ ìœ„ì˜ ìì‹ ì„ ìƒìƒí•´ ë³´ì„¸ìš”.
           ì‹¬ì‚¬ìœ„ì›ì˜ í”¼ë“œë°±ì€ ì†”ì§í•˜ì§€ë§Œ ë”°ëœ»í•©ë‹ˆë‹¤.`,
    badges:['ë¬´ëŒ€','ë®¤ì§','íŒ¬ì†Œí†µ'],
    avatar:{
      src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/Fox/glTF/Fox.gltf',
      pos:'0 0 -3', scale:'0.02 0.02 0.02'
    },
    props:[
      {src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/DracoCompression/ABuffer/glTF/ABuffer.gltf', pos:'-1 0 -2', scale:'0.6 0.6 0.6'}
    ],
    missions:[
      {id:'en1', title:'ë³´ì»¬ ìŠ¤ì¼€ì¼', desc:'ë„ë ˆë¯¸íŒŒì†”ë¼ì‹œë„ ì •í™•íˆ ë§ì¶”ê¸°', reward:'ì—°ìŠµë°°ì§€'},
      {id:'en2', title:'ì˜¤ë””ì…˜ ì œì¶œ', desc:'30ì´ˆ ì˜ìƒ í´ë¦½ ì—…ë¡œë“œ(ì‹œë®¬ë ˆì´ì…˜)', reward:'ì‹¬ì‚¬ í†µê³¼'},
      {id:'en3', title:'íŒ¬ë¯¸íŒ… Q&A', desc:'íŒ¬ 3ëª…ì—ê²Œ ë‹µë³€í•˜ê¸°', reward:'íŒ¬ì‚¬ì¸'},
      {id:'vr',  title:'í•˜ì´ë¼ì´íŠ¸ VR: ë¼ì´ë¸Œ ë¬´ëŒ€', desc:'í¬ê·¸ì™€ ë¼ì´íŠ¸ ì•„ë˜ ë‹¨ë… ë¬´ëŒ€', reward:'í—¤ë“œë¼ì´ë„ˆ ë°°ì§€'}
    ]
  },
  {
    id:'beauty', name:'ë¯¸íˆ¬ ë·°í‹°', tagline:'ë©”ì´í¬ì—…Â·í—¤ì–´Â·íŒ¨ì…˜Â·ëŸ°ì›¨ì´',
    sky:'#fff6fb',
    story:`ë·°í‹° ë©”íƒ€ëª°ì˜ ì‡¼ìœˆë„ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤. ìƒ‰ì¡°, í…ìŠ¤ì²˜, ì‹¤ë£¨ì—£.
           ë‹¹ì‹ ì˜ ì‹œê·¸ë‹ˆì²˜ ë£©ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.`,
    badges:['íŒ¨ì…˜','ë©”ì´í¬ì—…','ëŸ°ì›¨ì´'],
    avatar:{
      src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/AnimatedMorphSphere/glTF/AnimatedMorphSphere.gltf',
      pos:'0 0 -3', scale:'0.6 0.6 0.6'
    },
    props:[
      {src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/SciFiHelmet/glTF/SciFiHelmet.gltf', pos:'-1 0 -2', scale:'1 1 1'},
      {src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/Duck/glTF/Duck.gltf', pos:'1 0 -2', scale:'0.03 0.03 0.03'}
    ],
    missions:[
      {id:'bt1', title:'í†¤ ì¡°í•©', desc:'ë”°ëœ»/ì°¨ê°€ìš´ íŒ”ë ˆíŠ¸ ë¹„êµ í›„ ì„ íƒ', reward:'ìŠ¤íƒ€ì¼ í¬ì¸íŠ¸'},
      {id:'bt2', title:'í—¤ì–´ ë³€ì‹ ', desc:'3ê°€ì§€ í—¤ì–´ìŠ¤íƒ€ì¼ ì²´í—˜', reward:'í¬í†  ì¹´ë“œ'},
      {id:'bt3', title:'ë£© ì™„ì„±', desc:'ìƒì˜/í•˜ì˜/ì•¡ì„¸ì„œë¦¬ ì¡°í•©', reward:'ëŸ°ì›¨ì´ ì´ˆëŒ€'},
      {id:'vr',  title:'í•˜ì´ë¼ì´íŠ¸ VR: ëŸ°ì›¨ì´', desc:'í”Œë˜ì‹œ ì„¸ë¡€ ì† ìº£ì›Œí¬', reward:'ì•„ì´ì½”ë‹‰ ë£©'}
    ]
  },
  {
    id:'space', name:'ë¯¸íˆ¬ ìŠ¤í˜ì´ìŠ¤', tagline:'íƒì‚¬ì„  Â· ê¸°ì§€ Â· ì™¸ê³„ êµë¥˜ Â· ê·€í™˜',
    sky:'#000022',
    story:`ì°½ë¬¸ ë„ˆë¨¸ë¡œ í‘¸ë¥¸ ì§€êµ¬ê°€ ë©€ì–´ì§‘ë‹ˆë‹¤. ë¬´ì¤‘ë ¥ì˜ ê³ ìš” ì†ì—ì„œ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë°œê²¬í•˜ì„¸ìš”.`,
    badges:['ê³¼í•™','íƒí—˜','ê°œì²™'],
    avatar:{
      src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/Astronaut/glTF/Astronaut.gltf',
      pos:'0 0 -3', scale:'1 1 1'
    },
    props:[
      {src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/MetalRoughSpheres/glTF/MetalRoughSpheres.gltf', pos:'-1 0 -2', scale:'0.4 0.4 0.4'}
    ],
    missions:[
      {id:'sp1', title:'ë„í‚¹', desc:'ìš°ì£¼ì •ê±°ì¥ì— ì •ë°€ ë„í‚¹', reward:'ì¡°ì¢… ë°°ì§€'},
      {id:'sp2', title:'ìƒ˜í”Œ ì±„ì·¨', desc:'ì•”ì„ í‘œë³¸ 3ê°œ ìˆ˜ì§‘', reward:'ì§€ì§ˆ í‚¤íŠ¸'},
      {id:'sp3', title:'ì™¸ê³„ êµì‹ ', desc:'ì˜ë¯¸ íŒŒí˜• í•´ë…', reward:'ì™¸êµ í‘œì‹'},
      {id:'vr',  title:'í•˜ì´ë¼ì´íŠ¸ VR: ë‹¬ ê¸°ì§€ EVA', desc:'ìš°ì£¼ë³µì„ ì…ê³  ì›”ë©´ í™œë™', reward:'ì„ë¬´ ì™„ìˆ˜'}
    ]
  },
  {
    id:'life', name:'ë¯¸íˆ¬ ë¼ì´í”„', tagline:'ì¹´í˜ Â· ë†ì¥ Â· ë¯¸ìˆ ê´€ Â· ìŠ¤í¬ì¸ ',
    sky:'#bfe3c8',
    story:`í–‡ì‚´ì´ ë“œëŠ” ë¼ì´í”„íƒ€ìš´. ì˜¤ëŠ˜ì€ ì»¤í”¼ í–¥ìœ¼ë¡œ ì‹œì‘í•´, ì €ë…ì—” ë³„ë¹› ì•„ë˜ ì‚°ì±…ì„.`,
    badges:['íë§','ì·¨ë¯¸','ì†Œì…œ'],
    avatar:{
      src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/SheenChair/glTF/SheenChair.gltf',
      pos:'0 0 -3', scale:'0.8 0.8 0.8'
    },
    props:[
      {src:'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/CoffeeCart/glTF/CoffeeCart.gltf', pos:'-1 0 -2', scale:'0.5 0.5 0.5'}
    ],
    missions:[
      {id:'lf1', title:'ë°”ë¦¬ìŠ¤íƒ€', desc:'ë¼ë–¼ ì•„íŠ¸ 1íšŒ ì„±ê³µ', reward:'ì»¤í”¼ ë±ƒì§€'},
      {id:'lf2', title:'í…ƒë°­', desc:'ì”¨ì•— ì‹¬ê³  ë¬¼ ì£¼ê¸°', reward:'ë†ì¥ í‚¤íŠ¸'},
      {id:'lf3', title:'ìŠ¤ì¼€ì¹˜', desc:'ë¯¸ìˆ ê´€ì—ì„œ ìŠ¤ì¼€ì¹˜ 2ì¥', reward:'ì•„íŠ¸ í¬ì¸íŠ¸'},
      {id:'vr',  title:'í•˜ì´ë¼ì´íŠ¸ VR: ë³„ë¹› ì‚°ì±…', desc:'í˜¸ìˆ«ê°€ ë³´ë“œì›Œí¬ ì‚°ì±…', reward:'íë§ í† í°'}
    ]
  }
];

// ë¡œì»¬ ì €ì¥ì†Œ í‚¤
const LS_KEY = 'me2verse_v1';

/** =========================
 *  ìƒíƒœ & ìœ í‹¸
 *  ========================= */
let state = {
  user:null, // { id, guest:boolean }
  progress:{} // { [moduleId]: { done: Set<string>, badges: Set<string> } }
};

function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(raw){ state = JSON.parse(raw);
      // Set ë³µì›
      for(const k in state.progress){
        state.progress[k].done = new Set(state.progress[k].done);
        state.progress[k].badges = new Set(state.progress[k].badges);
      }
    }
  }catch(e){}
}
function saveState(){
  const safe = { user: state.user, progress:{} };
  for(const k in state.progress){
    safe.progress[k] = {
      done: Array.from(state.progress[k].done),
      badges: Array.from(state.progress[k].badges)
    };
  }
  localStorage.setItem(LS_KEY, JSON.stringify(safe));
}
function ensureModuleProgress(id){
  if(!state.progress[id]) state.progress[id] = { done:new Set(), badges:new Set() };
}

/** =========================
 *  DOM í—¬í¼
 *  ========================= */
const $ = s => document.querySelector(s);
const scrLogin = $('#scr-login');
const scrMods = $('#scr-mods');
const scrDetail = $('#scr-detail');
const scrSuggest = $('#scr-suggest');
const modsGrid = $('#modsGrid');
const modTitle = $('#modTitle');
const modTagline = $('#modTagline');
const modStory = $('#modStory');
const modProgress = $('#modProgress');
const modBadges = $('#modBadges');
const missionsList = $('#missionsList');
const userNameLabel = $('#userNameLabel');

function show(screen){
  [scrLogin,scrMods,scrDetail,scrSuggest].forEach(s=>s.classList.remove('active'));
  screen.classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
}

function toastVR(msg){ const el = $('#vrStatus'); el.textContent = msg; }

/** =========================
 *  ì´ˆê¸° ë¡œë“œ
 *  ========================= */
loadState();
if(state.user){
  userNameLabel.textContent = state.user.guest ? 'ê²ŒìŠ¤íŠ¸' : state.user.id;
  buildMods();
  show(scrMods);
}

/** =========================
 *  ë¡œê·¸ì¸
 *  ========================= */
$('#btnLogin').addEventListener('click', ()=>{
  const id = $('#piId').value.trim();
  if(!id){ alert('Pi ê³„ì • IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  state.user = { id, guest:false };
  saveState();
  userNameLabel.textContent = id;
  buildMods();
  show(scrMods);
});
$('#btnDemo').addEventListener('click', ()=>{
  state.user = { id:'guest', guest:true };
  saveState();
  userNameLabel.textContent = 'ê²ŒìŠ¤íŠ¸';
  buildMods();
  show(scrMods);
});

/** =========================
 *  ëª¨ë“ˆ ëª©ë¡ ìƒì„±
 *  ========================= */
function buildMods(){
  modsGrid.innerHTML = '';
  MODULES.forEach(m=>{
    ensureModuleProgress(m.id);
    const doneCnt = state.progress[m.id].done.size;
    const total = m.missions.length - 1; // vr ì œì™¸í•œ ì¼ë°˜ ë¯¸ì…˜ ê¸°ì¤€
    const pct = Math.min(100, Math.round(doneCnt/Math.max(1,total)*100));

    const card = document.createElement('div');
    card.className = 'mod';
    card.innerHTML = `
      <h3>${m.name}</h3>
      <div class="muted">${m.tagline}</div>
      <div class="progress" title="ì§„í–‰ë„"><span style="width:${pct}%"></span></div>
      <div class="chips">
        ${m.badges.map(b=>`<span class="badge">${b}</span>`).join('')}
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" data-open="${m.id}">ìŠ¤í† ë¦¬ ë³´ê¸°</button>
        <button class="btn ghost" data-quick="${m.id}">ë°”ë¡œ VR</button>
      </div>
    `;
    modsGrid.appendChild(card);
  });

  // ë°”ì¸ë”©
  modsGrid.querySelectorAll('[data-open]').forEach(btn=>{
    btn.addEventListener('click',()=>openDetail(btn.dataset.open));
  });
  modsGrid.querySelectorAll('[data-quick]').forEach(btn=>{
    btn.addEventListener('click',()=>{ openDetail(btn.dataset.quick,true); });
  });
}

/** =========================
 *  ëª¨ë“ˆ ìƒì„¸
 *  ========================= */
let currentModule = null;
function openDetail(id, quickVR=false){
  const m = MODULES.find(x=>x.id===id);
  if(!m) return;
  currentModule = m;
  ensureModuleProgress(m.id);

  modTitle.textContent = m.name;
  modTagline.textContent = m.tagline;
  modStory.textContent = m.story;

  // ì§„í–‰ë„/ë°°ì§€
  const doneCnt = state.progress[m.id].done.size;
  const total = m.missions.length - 1;
  const pct = Math.min(100, Math.round(doneCnt/Math.max(1,total)*100));
  modProgress.style.width = pct+'%';
  modBadges.innerHTML = '';
  state.progress[m.id].badges.forEach(b=>{
    const span = document.createElement('span'); span.className='badge'; span.textContent=b; modBadges.appendChild(span);
  });

  // ë¯¸ì…˜ ë¦¬ìŠ¤íŠ¸
  missionsList.innerHTML = '';
  m.missions.forEach(ms=>{
    const isVR = ms.id==='vr';
    const done = state.progress[m.id].done.has(ms.id);
    const item = document.createElement('div');
    item.className = 'mod';
    item.innerHTML = `
      <h3>${isVR?'ğŸ¬ ':''}${ms.title}</h3>
      <div class="muted">${ms.desc}</div>
      <div class="chips"><span class="badge">ë³´ìƒ: ${ms.reward}</span>${done?'<span class="badge">ì™„ë£Œ</span>':''}</div>
      <div style="display:flex;gap:8px;margin-top:6px">
        ${isVR
          ? `<button class="btn secondary" data-vr="${ms.id}">VR ì‹œì‘</button>`
          : `<button class="btn" data-done="${ms.id}">${done?'ì™„ë£Œë¨':'ë¯¸ì…˜ ìˆ˜í–‰'}</button>`
        }
        <button class="btn ghost" data-hint="${ms.id}">íŒíŠ¸</button>
      </div>
    `;
    missionsList.appendChild(item);
  });

  // ì´ë²¤íŠ¸
  missionsList.querySelectorAll('[data-done]').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const id = btn.dataset.done;
      state.progress[m.id].done.add(id);
      state.progress[m.id].badges.add('ìŠ¤í† ë¦¬ëŸ¬ë²„');
      saveState();
      openDetail(m.id); // ë¦¬í”„ë ˆì‹œ
      alert('ë¯¸ì…˜ ì™„ë£Œ! ë³´ìƒì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });
  });
  missionsList.querySelectorAll('[data-hint]').forEach(btn=>{
    btn.addEventListener('click',()=>{
      alert('íŒíŠ¸: ì§€í˜•ì§€ë¬¼ì„ ì˜ ê´€ì°°í•˜ê³ , NPCì—ê²Œ ë‹¤ê°€ê°€ ë³´ì„¸ìš”!');
    });
  });
  missionsList.querySelectorAll('[data-vr]').forEach(btn=>{
    btn.addEventListener('click',()=>enterVR(m));
  });

  // ìƒë‹¨ ë²„íŠ¼
  $('#btnStartVR').onclick = ()=>enterVR(m);
  $('#btnFreeTry').onclick = ()=>alert('ë¬´ë£Œì²´í—˜: í…ìŠ¤íŠ¸/ì´ë¯¸ì§€ë¡œ í•µì‹¬ íë¦„ì„ ë¯¸ë¦¬ ë³´ì—¬ì¤ë‹ˆë‹¤.');
  $('#btnSuggest').onclick = ()=>{ show(scrSuggest); };
  $('#btnHome').onclick = ()=> show(scrMods);
  $('#backToDetail').onclick = ()=> show(scrDetail);
  $('#backToMods').onclick = ()=> show(scrMods);
  $('#btnSuggestHome').onclick = ()=> show(scrMods);
  $('#btnSubmitSuggest').onclick = ()=>{
    const t = $('#suggestText').value.trim();
    if(!t) return alert('ì œì•ˆ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    const log = JSON.parse(localStorage.getItem('me2verse_suggests')||'[]');
    log.push({ by: state.user?.id || 'guest', text:t, at: Date.now(), module: m.id });
    localStorage.setItem('me2verse_suggests', JSON.stringify(log));
    $('#suggestText').value='';
    alert('ì œì¶œ ì™„ë£Œ! ê²€í†  í›„ ë°˜ì˜í•˜ê² ìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.');
  };

  show(scrDetail);
  if(quickVR) enterVR(m);
}

/** =========================
 *  VR ì§„ì…/ì¢…ë£Œ
 *  ========================= */
const vrWrap = $('#vrWrap');
const room = $('#room');
const sky = $('#sky');
const vrTitle = $('#vrTitle');

function enterVR(m){
  // ìŠ¤í† ë¦¬ í™”ë©´ì€ ê·¸ëŒ€ë¡œ, VRì€ ì˜¤ë²„ë ˆì´ë¡œ í‘œì‹œ(ê²¹ì¹˜ì§€ ì•ŠìŒ)
  vrWrap.style.display = 'block';
  document.body.style.overflow = 'hidden';
  vrTitle.textContent = `VR â€“ ${m.name}`;
  toastVR('ë¡œë”© ì¤‘â€¦');

  // ì”¬ ë¦¬ì…‹
  while(room.firstChild) room.removeChild(room.firstChild);

  // í™˜ê²½
  sky.setAttribute('color', m.sky);

  // ë°”ë‹¥
  const ground = document.createElement('a-circle');
  ground.setAttribute('radius','30');
  ground.setAttribute('rotation','-90 0 0');
  ground.setAttribute('color','#e9ecf7');
  ground.setAttribute('position','0 0 0');
  room.appendChild(ground);

  // ì•„ë°”íƒ€
  if(m.avatar){
    const a = document.createElement('a-gltf-model');
    a.setAttribute('src', m.avatar.src);
    a.setAttribute('position', m.avatar.pos);
    a.setAttribute('scale', m.avatar.scale);
    a.setAttribute('animation__spin','property=rotation; to=0 360 0; loop:true; dur:12000; easing:linear');
    a.addEventListener('click', ()=>{
      toastVR('ì•„ë°”íƒ€ì™€ ìƒí˜¸ì‘ìš©! ê°ì • í¬ì¸íŠ¸ +1');
    });
    room.appendChild(a);
  }
  // ì˜¤ë¸Œì íŠ¸
  (m.props||[]).forEach(p=>{
    const g = document.createElement('a-gltf-model');
    g.setAttribute('src', p.src);
    g.setAttribute('position', p.pos);
    g.setAttribute('scale', p.scale || '1 1 1');
    g.setAttribute('animation__float','property=position; dir:alternate; loop:true; dur:3000; to: 0 0.3 0;');
    g.addEventListener('click', ()=>{
      toastVR('ì•„ì´í…œ ìƒí˜¸ì‘ìš©! ë³´ìƒ ì§„ë™(ê°€ìƒ)');
    });
    room.appendChild(g);
  });

  setTimeout(()=>toastVR('ì‹œì‘! ì‹œì„ ì„ ì›€ì§ì—¬ ì£¼ë³€ì„ ë‘˜ëŸ¬ë³´ì„¸ìš”.'), 800);
}

$('#btnVRBack').addEventListener('click', ()=>{
  vrWrap.style.display = 'none';
  document.body.style.overflow = '';
  toastVR('ì¢…ë£Œ');
});
$('#btnVRHint').addEventListener('click', ()=>toastVR('íŒíŠ¸: ë¹›ë‚˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ í„°ì¹˜í•´ ë³´ì„¸ìš”!'));

/** =========================
 *  í™ˆ ë²„íŠ¼ë“¤
 *  ========================= */
$('#btnHome').addEventListener('click',()=> show(scrMods));
$('#backToMods').addEventListener('click',()=> show(scrMods));
</script>
</body>
  </html>
