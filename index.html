<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Me2Verse VR 메타버스 완성형</title>
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<style>
  body {margin:0;padding:0;font-family:Arial,sans-serif;background:#f0f0f0;}
  #status{position:fixed;top:10px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.85);padding:5px 10px;border-radius:5px;font-size:16px; z-index:5;}
  #score{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.6);color:white;padding:5px 10px;border-radius:5px;font-size:16px; z-index:5;}
  .screen{width:100%;height:100vh;display:flex;justify-content:center;align-items:center;flex-direction:column;transition:all 0.5s;position:absolute;top:0;left:0;}
  #homeScreen{background:white; z-index:3;}
  #moduleScreen{background:#fafafa;display:none; z-index:2;}
  #storyScreen{background:#fff;display:none; z-index:4; padding:10px; overflow-y:auto;}
  #vrScreen{background:black;display:none; z-index:1;}
  input,select,button{padding:10px 15px;margin:5px;font-size:16px;border-radius:5px;border:1px solid #ccc;}
  button{cursor:pointer;border:none;color:white;}
  #autoBtn{background-color:#2196F3;}
  .moduleBtn{background-color:#4CAF50;}
  #startVRBtn{background-color:#9C27B0;display:none;margin-top:10px;}
  #backBtn{background-color:#FF5722;display:none;margin-top:15px;}
  #questLog{margin-top:15px;background:rgba(255,255,255,0.8);padding:10px;border-radius:5px;width:80%;max-width:400px;font-size:14px;max-height:150px;overflow-y:auto;}
  a-scene{width:100%;height:100vh;}
  #flagContainer{display:flex; justify-content:space-between; width:100%; max-width:400px; margin-bottom:10px;}
  #flagContainer img{width:80px;}
</style>
</head>
<body>

<div id="status">상태: 대기 중</div>
<div id="score">포인트: 0 | 아이템: 없음</div>

<!-- 홈 화면 -->
<div id="homeScreen" class="screen">
  <div id="flagContainer">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg" alt="태극기">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg" alt="태극기">
  </div>
  <h1>🚀 Me2Verse VR 메타버스</h1>
  <p>로그인 → 모듈 선택 → 스토리 체험 → VR 체험</p>
  <input type="text" id="username" placeholder="Pi 네트워크 계정 입력">
  <button id="autoBtn">로그인</button>
</div>

<!-- 모듈 선택 화면 -->
<div id="moduleScreen" class="screen">
  <h2>모듈 선택</h2>
  <div id="moduleButtonsDiv">
    <button class="moduleBtn" id="loveModule">연애 모듈</button>
    <button class="moduleBtn" id="spaceModule">우주체험 모듈</button>
    <button class="moduleBtn" id="hobbyModule">취미 모듈</button>
  </div>
  <button id="backBtn">🏠 홈으로</button>
</div>

<!-- 스토리 화면 -->
<div id="storyScreen" class="screen">
  <h3 id="storyTitle"></h3>
  <div id="storyContent"></div>
  <button id="startVRBtn">VR 체험 시작</button>
  <button id="storyBackBtn">🏠 모듈 선택으로</button>
  <div id="questLog"></div>
</div>

<!-- VR 화면 -->
<div id="vrScreen" class="screen">
  <a-scene id="vrScene">
    <a-sky id="vrSky" color="#ECECEC"></a-sky>
    <a-entity id="moduleContent"></a-entity>
    <a-entity id="cameraRig" position="0 1.6 0">
      <a-camera wasd-controls look-controls>
        <a-cursor color="black"></a-cursor>
      </a-camera>
    </a-entity>
    <a-entity light="type: ambient; intensity:0.6"></a-entity>
    <a-entity light="type: directional; intensity:0.8" position="1 2 1"></a-entity>
  </a-scene>
  <button id="vrBackBtn" style="position:fixed;bottom:20px;right:20px;background:#FF5722;">🏠 뒤로가기</button>
</div>

<script>
// 상태, 점수
const statusEl=document.getElementById("status");
const scoreEl=document.getElementById("score");
let points=0, items=[], currentModule="", currentStory=0;
function updateScore(){ scoreEl.textContent=`포인트: ${points} | 아이템: ${items.length?items.join(", "):"없음"}`; }

// 로그인
document.getElementById("autoBtn").addEventListener("click",()=>{
  const username=document.getElementById("username").value.trim();
  if(!username){ alert("계정 입력 필요!"); return; }
  statusEl.textContent=`상태: ${username} 로그인 성공! 🎉`;
  document.getElementById("homeScreen").style.display="none";
  document.getElementById("moduleScreen").style.display="flex";
});

// 모듈 정의
const modules={
love:{title:"연애 모듈", sky:"#FFC0CB", avatars:[
  {type:"a-box", pos:"0 0 -3", points:10, item:"하트", log:"💌 캐릭터와 대화 완료 +10점"}
], stories:[
  {text:"공원에서 첫 만남", log:"첫 만남 +10점", points:10, item:"하트"},
  {text:"카페에서 커피", log:"커피 마시기 +5점", points:5},
  {text:"놀이공원 체험", log:"놀이기구 타기 +10점", points:10, item:"기념품"},
  {text:"영화관 데이트", log:"영화 보기 +5점", points:5},
  {text:"밤 산책", log:"밤 산책 +5점", points:5},
  {text:"공원 벤치에서 대화", log:"대화 +5점", points:5},
  {text:"강변 드라이브", log:"드라이브 +5점", points:5},
  {text:"꽃 선물 주기", log:"꽃 획득 +10점", points:10, item:"꽃"},
  {text:"포토타임", log:"사진 촬영 +5점", points:5},
  {text:"데이트 마무리", log:"데이트 종료 +10점", points:10}
]},
space:{title:"우주체험 모듈", sky:"#000022", avatars:[
  {type:"a-sphere", pos:"0 1.5 -4", points:15, item:"행성 지도", log:"🪐 행성 탐험 완료 +15점"}
], stories:[
  {text:"탐사선 탑승", log:"탑승 +5점", points:5},
  {text:"첫 행성 탐험", log:"행성 탐험 +10점", points:10, item:"지도"},
  {text:"위성 관찰", log:"위성 관찰 +5점", points:5},
  {text:"우주 미션 수행", log:"미션 완료 +15점", points:15, item:"보물"},
  {text:"은하 탐사", log:"은하 탐사 +10점", points:10},
  {text:"블랙홀 관찰", log:"블랙홀 +20점", points:20},
  {text:"유성우 관측", log:"유성우 +5점", points:5},
  {text:"외계 문명 발견", log:"외계문명 +15점", points:15, item:"데이터"},
  {text:"우주 사진 촬영", log:"사진 촬영 +5점", points:5},
  {text:"귀환", log:"귀환 완료 +10점", points:10}
]},
hobby:{title:"취미 모듈", sky:"#A0E0A0", avatars:[
  {type:"a-cone", pos:"-1 0.5 -3", points:5, item:"꽃", log:"🌳 산책 완료 +5점"}
], stories:[
  {text:"숲속 산책", log:"산책 +5점", points:5},
  {text:"커피 만들기", log:"커피 제작 +5점", points:5, item:"커피"},
  {text:"꽃 관찰", log:"꽃 관찰 +5점", points:5, item:"꽃"},
  {text:"사진 촬영", log:"사진 +5점", points:5},
  {text:"그림 그리기", log:"그림 +5점", points:5, item:"그림"},
  {text:"책 읽기", log:"독서 +5점", points:5},
  {text:"베이킹", log:"베이킹 +5점", points:5, item:"쿠키"},
  {text:"악기 연주", log:"연주 +5점", points:5},
  {text:"DIY 프로젝트", log:"DIY 완료 +5점", points:5, item:"작품"},
  {text:"휴식", log:"휴식 완료 +5점", points:5}
]}
};

// 모듈 선택
const moduleBtns=["loveModule","spaceModule","hobbyModule"];
moduleBtns.forEach(id=>{
  document.getElementById(id).addEventListener("click",()=>{
    currentModule=id.replace("Module","");
    currentStory=0;
    document.getElementById("moduleScreen").style.display="none";
    document.getElementById("storyScreen").style.display="flex";
    loadStory();
  });
});

// 스토리 화면 요소
const storyTitle=document.getElementById("storyTitle");
const storyContent=document.getElementById("storyContent");
const startVRBtn=document.getElementById("startVRBtn");
const storyBackBtn=document
